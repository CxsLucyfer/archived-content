---
title: 'Apéndice E: DOM e inserción HTML'
slug: 'Mozilla/Tech/XUL/Escuela_XUL/Apéndice_E:_DOM_e_inserción_HTML'
translation_of: Archive/Add-ons/Overlay_Extensions/XUL_School/DOM_Building_and_HTML_Insertion
---
<div class="warning notecard">
<p>Support for extensions using XUL/XPCOM or the Add-on SDK was removed in Firefox 57, released November 2017. As there is no supported version of Firefox enabling these technologies, this page will be removed by December 2020.</p>
</div>

<p></p><div class="warning notecard"><p>Add-ons using the techniques described in this document are considered a legacy technology in Firefox. Don&apos;t use these techniques to develop new add-ons. Use <a href="/en-US/Add-ons/WebExtensions">WebExtensions</a> instead. If you maintain an add-on which uses the techniques described here, consider migrating it to use WebExtensions.</p><p><strong>Starting from <a href="https://wiki.mozilla.org/RapidRelease/Calendar">Firefox 53</a>, no new legacy add-ons will be accepted on addons.mozilla.org (AMO) for desktop Firefox and Firefox for Android.</strong></p><p><strong>Starting from <a href="https://wiki.mozilla.org/RapidRelease/Calendar">Firefox 57</a>, only extensions developed using WebExtensions APIs will be supported on Desktop Firefox and Firefox for Android. </strong></p><p>Even before Firefox 57, changes coming up in the Firefox platform will break many legacy extensions. These changes include multiprocess Firefox (e10s), sandboxing, and multiple content processes. Legacy extensions that are affected by these changes should migrate to use WebExtensions APIs if they can. See the <a href="https://blog.mozilla.org/addons/2017/02/16/the-road-to-firefox-57-compatibility-milestones/">&quot;Compatibility Milestones&quot; document</a> for more information.</p><p>A wiki page containing <a href="https://wiki.mozilla.org/Add-ons/developer/communication">resources, migration paths, office hours, and more</a>, is available to help developers transition to the new technologies.</p></div><section class="Quick_links" id="Quick_Links">
  <ol>
    <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions"><strong>Browser extensions</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Getting started</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions">What are extensions?</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension">Your first extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension">Your second extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension">Anatomy of an extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Examples">Example extensions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/What_next_">What next?</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Concepts</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs">Using the JavaScript APIs</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">Content scripts</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Match_patterns">Match patterns</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Working_with_files">Working with files</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Internationalization">Internationalization</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Security_best_practices">Security best practices</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy">Content Security Policy</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Native_messaging">Native messaging</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>User interface</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface">User Interface</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action">Toolbar button</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions">Address bar button</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars">Sidebars</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items">Context menu items</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages">Options page</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages">Extension pages</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications">Notifications</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox">Address bar suggestions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels">Developer tools panels</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>How to</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests">Intercept HTTP requests</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page">Modify a web page</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page">Insert external content</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar">Add a button to the toolbar</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page">Implement a settings page</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API">Work with the Tabs API</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API">Work with the Bookmarks API</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API">Work with the Cookies API</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities">Work with contextual identities</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/onboarding_upboarding_offboarding_best_practices">Onboard, upboard, and offboard users</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Porting</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators">Firefox differentiators</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Porting_a_Google_Chrome_extension">Porting a Google Chrome extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Porting_a_legacy_Firefox_add-on">Porting a legacy Firefox extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Embedded_WebExtensions">Embedded WebExtensions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_the_Add-on_SDK">Comparison with the Add-on SDK</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_XUL_XPCOM_extensions">Comparison with XUL/XPCOM extensions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations">Differences between API implementations</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities">Chrome incompatibilities</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Differences_between_desktop_and_Android">Differences between desktop and Android</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Firefox workflow</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Development_Tools">Developer tools</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/User_experience_best_practices">User Experience</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Temporary_Installation_in_Firefox">Temporary Installation in Firefox</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Debugging">Debugging</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Testing_persistent_and_restart_features">Testing persistent and restart features</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Developing_WebExtensions_for_Firefox_for_Android">Developing for Firefox for Android</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Getting_started_with_web-ext">Getting started with web-ext</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/web-ext_command_reference">web-ext command reference</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/WebExtensions_and_the_Add-on_ID">Extensions and the Add-on ID</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Request_the_right_permissions">Request the right permissions</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>JavaScript APIs</summary>
        <ol><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs">Browser support for JavaScript APIs</a></li><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/API/i18n">i18n</a></li><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/API/storage">storage</a></li><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation">webNavigation</a></li></ol>
      </details>
    </li>

    <li class="toggle">
      <details>
      <summary>Manifest keys</summary>

      </details>
    </li>

    <li><a href="/es/docs/Mozilla/Add-ons/Themes"><strong>Themes</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Browser themes</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/Themes/Theme_concepts">Browser theme concepts</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Themes/Using_the_AMO_theme_generator">Using the AMO theme generator</a></li>
        </ol>
      </details>
    </li>
    <li><a href="/es/docs/Mozilla/Add-ons/Distribution"><strong>Publishing and Distribution</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Publishing add-ons</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution">Signing and distribution overview</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Package_your_extension_">Package your extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Submitting_an_add-on">Submit an add-on</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Source_Code_Submission">Source code submission</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Resources_for_publishers">Resources for publishers</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Listing">Creating an appealing listing</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Make_money_from_browser_extensions">Make money from browser extensions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Promoting_your_extension_or_theme">Promoting your extension or theme</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/AMO/Policy/Reviews">Review policies</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/AMO/Policy/Agreement">Developer agreement</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/AMO/Policy/Featured">Featured add-ons</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Retiring_your_extension">Retiring your extension</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Distributing add-ons</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Sideloading_add-ons">For sideloading</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_for_desktop_apps">For desktop apps</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_in_the_enterprise">For an enterprise</a></li>
        </ol>
      </details>
    </li>
    <li><a href="https://discourse.mozilla.org/c/add-ons"><strong>Community and Support</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Channels</summary>
        <ol>
          <li><a href="https://blog.mozilla.org/addons">Add-ons blog</a></li>
          <li><a href="https://discourse.mozilla.org/c/add-ons">Add-on forums</a></li>
          <li><a href="https://stackoverflow.com/questions/tagged/firefox-addon">Stack Overflow</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/#Contact_us">Contact us</a></li>
        </ol>
      </details>
    </li>
  </ol>
</section><p></p>

<p>Many add-ons need to dynamically generate DOM content, either XUL or HTML, from their scripts. For security reasons, and to prevent errors, care needs to be taken to avoid evaluating arbitrary text as HTML. Failure to do so can lead to execution or remote scripts, and in the worst cases to privilege escalation which can leave a user&apos;s PC open to remote attack.</p>

<h2 id="Building_DOM_Trees">Building DOM Trees</h2>

<p>In most cases, DOM trees should be built exclusively with DOM creation methods. The following methods will all safely create a DOM tree without risk of remote execution.</p>

<h3 id="E4X_Templating">E4X Templating</h3>

<p>The following function can be used to generate DOM nodes from <a href="/en/E4X" title="en/E4X">E4X</a> XML objects. It has the advantage of appearing identical to ordinary HTML, but the disadvantage of being nearly exclusive to Firefox.</p>

<pre class="brush: js">var HTML = Namespace(&quot;html&quot;, &quot;http://www.w3.org/1999/xhtml&quot;);
var XUL = Namespace(&quot;xul&quot;, &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);

default xml namespace = HTML;
function xmlToDOM(xml, doc, nodes) {
   if (xml.length() != 1) {
       let domnode = doc.createDocumentFragment();
       for each (let child in xml)
           domnode.appendChild(xmlToDOM(child, doc, nodes));
       return domnode;
   }
   switch (xml.nodeKind()) {
   case &quot;text&quot;:
       return doc.createTextNode(String(xml));
   case &quot;element&quot;:
       let domnode = doc.createElementNS(xml.namespace(), xml.localName());
       for each (let attr in xml.@*::*)
           domnode.setAttributeNS(attr.namespace(), attr.localName(), String(attr));

       for each (let child in xml.*::*)
           domnode.appendChild(xmlToDOM(child, doc, nodes));
       if (nodes &amp;&amp; &quot;@key&quot; in xml)
           nodes[xml.@key] = domnode;
       return domnode;
   default:
       return null;
   }
}</pre>

<p>When passed an XML literal and a document, it returns the DOM tree corresponding to the XML for that document. If passed a third argument, the DOM node created for any element with a &quot;key&quot; attribute, is stored in a property of the given object named for the &quot;key&quot; attribute&apos;s value.</p>

<pre class="brush: js">default xml namespace = XUL;

var href = &quot;http://www.google.com/&quot;;
var text = &quot;Google&quot;;
var nodes = {};
document.documentElement.appendChild(
    xmlToDOM(&lt;hbox xmlns:html={HTML}&gt;
            &lt;html:div&gt;
                &lt;a href={href} target=&quot;_top&quot; key=&quot;link&quot;&gt;{text}&lt;/a&gt;
            &lt;/html:div&gt;
        &lt;/hhox&gt;,
        document, nodes);

    nodes.link.addEventListener(&quot;click&quot;, function (event) { alert(event.target.href); }, false);</pre>

<h3 id="JSON_Templating">JSON Templating</h3>

<p>For code which needs to be cross-browser compatible, a similar templating system can be used, based on JSON objects rather than E4X. It also has the advantage of being slightly more concise than the E4X variant, though no easier to read.</p>

<pre class="brush: js">var namespaces = {
    html: &quot;http://www.w3.org/1999/xhtml&quot;,
    xul: &quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;
};

jsonToDOM.defaultNamespace = namespaces.html;
function jsonToDOM(xml, doc, nodes) {
    function namespace(name) {
       var m = /^(?:(.*):)?(.*)$/.exec(name);
       return [namespaces[m[1]], m[2]];
    }

   function tag(name, attr) {
       if (isArray(name)) {
           var frag = doc.createDocumentFragment();
           Array.forEach(arguments, function (arg) {
               if (!isArray(arg[0]))
                   frag.appendChild(tag.apply(null, arg));
               else
                   arg.forEach(function (arg) {
                       frag.appendChild(tag.apply(null, name[i]));
                   });
           });
           return frag;
       }

       var args = Array.slice(arguments, 2);
       var vals = namespace(name);
       var elem = doc.createElementNS(vals[0] || jsonToDOM.defaultNamespace,
                                      vals[1]);

       for (var key in attr) {
           var val = attr[key];
           if (nodes &amp;&amp; key == &quot;key&quot;)
               nodes[val] = elem;

           vals = namespace(key);
           if (typeof val == &quot;function&quot;)
               elem.addEventListener(key.replace(/^on/, &quot;&quot;), val, false);
           else
               elem.setAttributeNS(vals[0] || &quot;&quot;, vals[1], val);
       }
       args.forEach(function(e) {
           elem.appendChild(typeof e == &quot;object&quot; ? tag.apply(null, e) :
                            e instanceof Node    ? e : doc.createTextNode(e));
       });
       return elem;
   }
   return tag.apply(null, xml);
}</pre>

<p>In the above, the <code>namespaces</code> object defines the namespace prefixes which can be used in the given DOM tree. Event listeners can be defined on the given nodes by passing functions rather than strings to on* attributes.</p>

<pre class="brush: js">var href = &quot;http://www.google.com/&quot;;
var text = &quot;Google&quot;;
var nodes = {};
document.documentElement.appendChild(
    jsonToDOM([&quot;xul:hbox&quot;, {},
        [&quot;div&quot;, {},
            [&quot;a&quot;, { href: href, key: &quot;link&quot;,
                    onclick: function (event) { alert(event.target.href); } },
                text],
            [&quot;span&quot;, { class: &quot;stuff&quot; },
                &quot;stuff&quot;]]],
        document, nodes));

alert(nodes.link);</pre>

<h3 id="jQuery_Templating">jQuery Templating</h3>

<p>For extensions which already use jQuery, it is possible to use its builtin DOM building functions for templating, though care must be taken when passing non-static strings to methods such as <code>.append()</code> and <code>.html()</code>. In most cases, <code>.text()</code> should be used instead of the latter. When using the <code>jQuery</code> constructor, only empty tags should be specified in order to avoid invoking the DOM parser.</p>

<pre class="brush: js">var href = &quot;http://www.google.com/&quot;;
var text = &quot;Google&quot;;
 $(&quot;body&quot;).append(
    $(&quot;&lt;div&gt;&quot;, { class: &quot;foo&quot; })
        .append($(&quot;&lt;a&gt;&quot;, { href: href, text: text })
                    .click(function (event) { alert(event.target.href) }))
        .append($(&quot;&lt;span&gt;&quot;).text(&quot;Foo&quot;)));</pre>

<h3 id="innerHTML_with_HTML_Escaping">innerHTML with HTML Escaping</h3>

<p>This method is a last resort which should be used only as a temporary measure in established code bases. It is safe, though inefficient, to assign dynamic values to <code>innerHTML</code> if any dynamic content in the value is escaped with the following function:</p>

<pre class="brush: js">function escapeHTML(str) str.replace(/[&amp;&quot;&lt;&gt;]/g, function (m) &quot;&amp;&quot; + ({ &quot;&amp;&quot;: &quot;amp&quot;, &apos;&quot;&apos;: &quot;quot&quot;, &quot;&lt;&quot;: &quot;lt&quot;, &quot;&gt;&quot;: &quot;gt&quot; })[m] + &quot;;&quot;);</pre>

<p>Note that quotation marks must be escaped in order to prevent fragments escaping attribute values, and that single quotes may not be used to quote attribute values in the fragment.</p>

<pre class="brush: js">var href = &quot;http://www.google.com/&quot;;
var text = &quot;Google&quot;;

document.getElementById(&quot;target-div&quot;).innerHTML = &apos;&lt;div&gt;\
        &lt;a href=&quot;&apos; + escapeHTML(href) &apos;&quot; target=&quot;_top&quot;&gt;&apos; + escapeHTML(text) + &apos;&lt;/a&gt;\
    &lt;/div&gt;&apos;</pre>

<p>It needs to be stressed that this method <strong>should not be used in new code</strong> and is only a temporary measure to shore up legacy code bases.</p>

<h2 id="Safely_Generating_Event_Listeners_and_Scripts">Safely Generating Event Listeners and Scripts</h2>

<p>It is occasionally necessary to generate event listeners and script fragments from dynamic content. Great care must be taken in these situations. Under no circumstances should code resembling <code>&apos;callback(&quot;&apos; + str + &apos;&quot;)&apos;</code> appear anywhere in your add-on.</p>

<h3 id="Closures">Closures</h3>

<p>By far the best way to create dynamic event listeners is to use closures. The following two code fragments are roughly equivalent:</p>

<pre class="brush: js">function clickify(elem, address) {
    elem.addEventListener(&quot;click&quot;, function (event) { openWindow(address) }, false);
}

function clickify(elem, address) {
    elem.onclick = function (event) { openWindow(address) };
}</pre>

<h3 id="Multiple_Attributes">Multiple Attributes</h3>

<p>Sometimes there is a need for event listeners to appear as attributes in the DOM. In these cases, multiple attributes should be used, one for each variable:</p>

<pre class="brush: js">function clickify(elem, address) {
    elem.setAttribute(&quot;href&quot;, address);
    elem.setAttribute(&quot;onclick&quot;, &quot;openWindow(this.getAttribute(&apos;href&apos;))&quot;);
}</pre>

<h3 id="Escaping_Functions">Escaping Functions</h3>

<p>When the code fragment in question is not an event handler attribute and there is no feasible way to pass the data through other means, they must be escaped with functions such as <code>uneval</code>, <a href="/en/JavaScript/Reference/Global_Objects/String/quote" title="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String/quote"><code>String.quote</code></a>, <a href="/en/JavaScript/Reference/Global_Objects/JSON/stringify" title="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/JSON/stringify"><code>JSON.stringify</code></a>, or <a href="/en/JavaScript/Reference/Global_Objects/Number" title="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Number">Number</a>. Generating scripts in this matter is deprecated and <strong>should be avoided wherever possible</strong>, but is relatively safe and sometimes acceptable.</p>

<pre class="brush: js">function createScript(href, otherStuff) {
    var script = function (href, otherStuff) {
        doStuffWith(href);
        doOtherStuff();
        for (var someStuff in otherStuff)
            doSomeMoreStuffWith(someStuff);
    }

    return script.toSource() + &quot;(&quot; + [String.quote(href), uneval(otherStuff)] + &quot;)&quot;;
}</pre>

<h2 id="Safely_Using_Remote_HTML">Safely Using Remote HTML</h2>

<p>In the above cases, we&apos;re working with text content that needs to appear in generated DOM. There are cases, however, where we need to safely display formatted HTML sent by a remote server. Fortunately, there is a safe and simple way to do this. The <code><a href="https://developer.mozilla.org/es/docs/XPCOM_Interface_Reference/nsIScriptableUnescapeHTML#parseFragment()">nsIScriptableUnescapeHTML.parseFragment()</a></code> method will convert a string to a document fragment while removing any scripts or other unsafe content in the process.</p>

<pre class="brush: js">function ParseHTML(doc, html) {
    return Components.classes[&quot;@mozilla.org/feed-unescapehtml;1&quot;]
                     .getService(Components.interfaces.nsIScriptableUnescapeHTML)
                     .parseFragment(html, false, null, doc.documentElement);
}</pre>

<p>The returned fragment may be appended to any element in the given document.</p>

<pre class="brush: js">document.body.appendChild(ParseHTML(document, xhr.responseText, xhr.channel.name);</pre>

<h2 id="See_Also">See Also</h2>

<ul>
 <li><a href="/En/Displaying_web_content_in_an_extension_without_security_issues">Displaying web content in an extension without security issues</a></li>
 <li><a href="/en/How_to_create_a_DOM_tree">How to create a DOM tree</a></li>
 <li><a href="/es/docs/Web/API/Node/textContent"><code>Node.textContent</code></a></li>
 <li><a href="/es/docs/Web/API/Node/appendChild"><code>Node.appendChild()</code></a></li>
 <li><a href="/es/docs/Web/API/Element/setAttribute"><code>element.setAttribute()</code></a></li>
 <li><a href="/en/DOM/document.createElement">document.createElement()</a></li>
 <li><a href="/en/DOM/document.createTextNode">document.createTextNode()</a></li>
</ul>

<div class="originaldocinfo">
<h2 id="Original_Document_Information" name="Original_Document_Information">Original Document Information</h2>

<ul>
 <li>Author(s): Kris Maglione</li>
 <li>Last Updated Date: 2011-08-08</li>
</ul>
</div>

<p> </p>
