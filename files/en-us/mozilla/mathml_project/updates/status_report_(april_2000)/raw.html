<p> </p>
<table> <tbody> <tr> <td><img alt="thomson.png" class="internal default" src="/@api/deki/files/6158/=thomson.png"><br> <small> Mozilla MathML v0.x rendition of the<br> "<a class="external" href="http://hutchinson.belmont.ma.us/tth/mmlreview/">Incoherent Thomson Scattering Theory</a>" [ <a>Markup</a> ] </small></td> </tr> </tbody>
</table>
<p> </p>
<p><strong>Contents</strong></p>
<ul> <li>Introduction</li> <li>Flashback</li> <li>Progress in the implementation</li> <li>Taking Stock</li> <li>To Do...</li>
</ul>
<h2 id="Introduction">Introduction</h2>
<p>The <a class="external" href="http://www-archive.mozilla.org/projects/mathml/">MathML Project</a> has been steadily progressing ever since it started in mid-May 1999, and indeed, ever since the <a class="external" href="http://www-archive.mozilla.org/projects/mathml/update-1999-Sep-18.html">previous status report</a> dated September 1999.</p>
<p>The driving focus in the first-step of the project is to support <a class="external" href="http://www.w3.org/TR/REC-MathML/chap3_1.html">Presentation markup</a>, which is more general than <a class="external" href="http://www.w3.org/TR/REC-MathML/chap4_1.html">Content markup</a>. It should be recalled that a XSL-T processor (such as <a class="external" href="http://lxr.mozilla.org/mozilla/source/extensions/transformiix/docs/readme.html">TransforMiiX</a> which is scheduled to be directly available from within Mozilla) enables the rendering of Content markup by first transforming to Presentation markup. However, native support for Content markup is envisaged at some stage in the MathML project. This native option is primarily enabling, as it will provide authors the ability to perform dynamic/interactive math with both Presentation markup and Content markup through the <a class="external" href="http://www-archive.mozilla.org/newlayout/dom-roadmap.html">DOM</a> and <a class="external" href="http://www-archive.mozilla.org/js/">JavaScript</a>. In the meantime authors can simply transform Content markup to Presentation markup and/or use parallel markup.</p>
<p>Efforts of the MathML project have culminated to the point where all presentational tags are recognized, except the alignment tags &lt;<span class="tag">malignmark</span>/&gt; and &lt;<span class="tag">maligngroup</span>/&gt; --both of which happen to be unsupported by most of the existing MathML renderers. Some presentational tags need another pass to further beautify their layout, by filling such things as the italic correction and/or the amount of spacing between some tags. This finishing stylistic touch is motivated by the professionalism that authors have come to expect from sophisticated mathematical typesetting system such as <a class="external" href="http://www.tug.org/">TeX/LaTeX</a>.</p>
<p> </p>
<p>Also, further work remain to render &lt;<span class="tag">mtable</span>&gt; in a fully standards compliant manner, or at least at a level where its usage is pleasant when laying out common mathematical 2D constructs such as matrices, arrays, commutative diagrams. Progress in this direction will rely upon some other work in the CSS2 &lt;<span class="tag">table</span>&gt; model that <a class="external" href="http://www-archive.mozilla.org/newlayout/">Gecko</a> implements.</p>
<h2 id="Flashback">Flashback</h2>
<p>Several months have passed since the previous status report. This is a long time for many things to happen. And indeed they did. Code-wise and elsewhere.</p>
<p>A significant event to the MathML project came from the contribution of Shyjan Mahamud &lt;<a class=" link-mailto" href="mailto:mahamud@cs.cmu.edu" rel="freelink">mahamud@cs.cmu.edu</a>&gt; who taught <a class="external" href="http://www.tug.org/">TeX</a> rendering rules to the MathML engine. All the ingredients are now in the code to further refine special cases if need be.</p>
<p>A MathML component was created in <a class="external" href="http://bugzilla.mozilla.org/">BugZilla</a>, the mozilla.org's system for tracking bugs and features.</p>
<p>The <a class="external" href="http://www-archive.mozilla.org/newlayout/team.html">Gecko team</a>, which is supportive of the MathML effort and has been helpful to this writer, has seen two key members moved on. This is a good opportunity to thank them: Kipp Hickman (co-inventor of SSLv1 and v2), the "principal smart guy", and Peter Linss who pioneered the <a class="external" href="http://www-archive.mozilla.org/newlayout/doc/style.html">Style System</a>. They guided the very first steps of this writer with some incisive explanations of the Gecko code. Of course, their departure means additional strain on Gecko developers in particular, and on Mozilla developers in general. This contributor is therefore appreciative of the extra efforts of current developers to accommodate the extra MathML requirements (e.g., in layout and gfx) as their schedules permit.</p>
<p>Other noteworthy events that have happened include an ongoing effort to release a <a class="external" href="http://www.w3.org/">W3C</a>'s <a class="external" href="http://www.geomtech.com/%7Erminer/mmltests">MathML Test Suite</a>, and the release of a draft specification for <a class="external" href="http://www.w3.org/TR/MathML2/">MathML 2.0</a>. So many standards, so little time, as someone would say.</p>
<p>To answer a question frequently asked, the MathML component was the first Mozilla component entirely driven from outside of Netscape, with no commitment from Netscape to include the component in its next release. Those who have been following the MathML project have come to realize how picky and non-trivial MathML is. As a result, since MathML builds upon the solid foundation that Gecko provides, some people perceive that MathML provides a good testbed of the Gecko code, and, at the same time, shows how capable and extensible the Gecko architecture is. But whether MathML can formally make it in the next Netscape release is best left as hopelessly hopeful. All these show why the MathML project is unique in several aspects and is worthy of your support!</p>
<h2 id="Progress_in_the_implementation">Progress in the implementation</h2>
<p>As it is expected from a rapidly moving target such as Mozilla, there has been a great number of changes throughout Mozilla, some of which have had a direct impact on the MathML component. In particular, as a result of a work aimed at consolidating the Style System, the <span class="function">ReResolveStyleContext()</span> method was removed from the nsIFrame API. The MathML engine is now using another approach to get the desired stylistic effects for scripting elements. Because this is an important aspect of MathML rendering, a <a href="#style">separate section</a> with in-depth technical details on this subject is provided later in this document.</p>
<p>The functionalities that were added to the MathML code fall into the following topics:</p>
<h3 id="Fonts">Fonts</h3>
<ul> <li><span class="function">GetBoundingMetrics()</span><br> Shyjan Mahamud &lt;<a class=" link-mailto" href="mailto:mahamud@cs.cmu.edu" rel="freelink">mahamud@cs.cmu.edu</a>&gt; demonstrated that accurate text metrics could be obtained, and so was born the <span class="function">GetBoundingMetrics()</span> function that was added in the nsIRenderingContext API. This is an important function used for accurate measurements of strings in order to allow precise positioning when processing MathML. It provides more information than the other functions used for HTML processing. The availability of this function has paved the way for a major enhancement of the MathML code in two areas which will be presented later: TeX rendering rules and stretchy characters. Unfortunately, because the <span class="function">GetBoundingMetrics()</span> function is a low-level platform-specific function that hasn't yet been ported on all of the main platforms, printing of MathML and rendering of MathML on the MacOS are not yet working.</li> <li><strong>The <span class="module">ucvmath</span> module</strong><br> Another major font hurdle was alleviated owing to the creation of the <span class="module">ucvmath</span> module with the glue provided by Mozilla's <a class="external" href="http://www-archive.mozilla.org/projects/intl/charset-converters.html">Charset Converter Manager</a> (CCM). For "symbolic" scientific fonts currently needed for MathML purposes, the CCM is used to map Unicode points to <a class="external" href="http://www.mathtype.com/support/tech/encodings/font_enc.stm">font encoding indices</a>. The <span class="module">ucvmath</span> module is the gateway from which to gradually support any useful mathematical/scientific font. Currently, it supports TeX's CMEX and CMSY, MT Extra, and the Mathematica fonts (Math1, Math2, Math3, Math4, Math5). These fonts are freely downloadable. Thus the <span class="module">ucvmath</span> module gives access to a rich collection of about a thousand professionally hinted glyphs for scientific typesetting, enough for a first version of the Mozilla MathML renderer, and ready for the inclusion of the much awaited <a class="external" href="http://www.ams.org/STIX/">STIX project</a>.</li>
</ul>
<h3 id="Rendering">Rendering</h3>
<ul> <li><strong>TeX Rendering Rules</strong><br> Shyjan Mahamud &lt;<a class=" link-mailto" href="mailto:mahamud@cs.cmu.edu" rel="freelink">mahamud@cs.cmu.edu</a>&gt; significantly improved the visual appearance by implementing the TeX alignment rules which are documented in Appendix G of the TeXbook. Since Mozilla uses CSS frames, it was possible to apply the placements of TeX "boxes" on Mozilla CSS frames by using the accurate metrics provided by the <span class="function">GetBoundingMetrics()</span> function mentioned earlier. (A CSS frame maps to a &lt;<span class="tag">tag</span>&gt;content&lt;/<span class="tag">tag</span>&gt; and has nothing to do with the HTML &lt;<span class="tag">frame</span>&gt;). However, since these placements involve additional TeX specific font metrics not found in ordinary fonts, Shyjan computed approximations of these metrics. As a result of TeX rules, the rendering of the MathML engine looks much classy. With such a quality rendering governed by TeX rules, the only remaining aspect that wasn't considered during the first pass is the amount of spacing between some tags and/or the so-called italic correction, i.e., the amount of space to add after an italicized string before immediately placing a superscript (or another string in an upright style). Another pass over the code will be needed to take these into account.</li> <li><strong>Stretchy operators</strong><br> <img alt="stretchy.png" class="internal default" src="/@api/deki/files/6157/=stretchy.png"> Stretchy operators reflects the ability of some characters to "auto-grow" vertically or horizontally depending on their surrounding context. This is one of the distinctive features of mathematical typesetting. Moving from an early prototype implementation impeded by the lack of fonts, it was possible after the availability of the <span class="module">ucvmath</span> module to develop a fully-fledge implementation of the <span class="object">nsMathMLChar</span> class that is able to perform "glyph-searching-and-switching" within the same font or across different fonts in order to select the best glyph for a given situation. If no glyph of appropriate size is found, the <span class="object">nsMathMLChar</span> class selects an appropriate set of partial glyphs and assemble them to build a character of larger size. The modular and extensible design of this process makes it possible to add support for other fonts, as need arise, by simply adding the data sets corresponding to each font.<br> <br> Central to the support of stretchy characters is the <span class="function">GetBoundingMetrics()</span> function together with "symbolic" fonts. Owing to Mozilla's <a class="external" href="http://www-archive.mozilla.org/projects/intl/fonts.html">font</a> guru on Win32 and Linux, Erik van der Poel, who even had to redesign the Win32's font code to support the Symbol font, it has been possible to include the other fonts that are in the <span class="module">ucvmath</span> module. Without the <span class="function">GetBoundingMetrics()</span> function and the support for "symbolic" fonts, much would still be pending in the MathML engine.</li> <li><strong>Embellished Operators</strong><br> Embellished operators represent a special class of operators whose behavior depend on a wider context than that of normal operators.<br> <br> By way of an example, consider the following fragment: <pre>&lt;<span class="tag">mrow</span>&gt;
  &lt;<span class="tag">msub</span>&gt;
     &lt;<span class="tag">mo</span>&gt;&amp;Integral;&lt;/<span class="tag">mo</span>&gt;
     &lt;<span class="tag">mi</span>&gt;&amp;Omega;&lt;/<span class="tag">mi</span>&gt;
  &lt;/<span class="tag">msub</span>&gt;
  &lt;!-- markup to produce something really tall here --&gt;
  ...
&lt;/<span class="tag">mrow</span>&gt;
</pre> What should happen is that the &amp;Integral; should stretch to enclose the content beyond its direct XML parent, <strong>and...</strong> &amp;Omega; should remain the subscript of the stretched integral. In other words, it is as if the corresponding &lt;<span class="tag">msub</span>&gt;...&lt;/<span class="tag">msub</span>&gt; <em>is</em> a mutable operator as a whole. In this case, the MathML REC refers to this &lt;<span class="tag">msub</span>&gt; as an "embellished operator". The definition is recursive and drills into nested tags. In MathML there is no other automatic way to make the ∫ (or other operators such as ∑) appropriatedly large unless they are treated as embellished operators. The support of embellished operators was added as a core aspect of the MathML architecture.<br> <br> The snapshot of the "Incoherent Thomson Scattering Theory" given above shows embellished and stretchy operators in action.</li> <li><strong>Other</strong><br> Other works in the MathML project have included: <ul> <li>the support for CSS units on numeric values (like in <span class="attribute">lspace=</span>"10px", <span class="attribute">linethickness=</span>"2pt", <span class="attribute">maxsize=</span>"200%", <span class="attribute">subscriptshift=</span>"0.5em", etc);</li> <li>the implementation of more tags with support for their attributes (like &lt;<span class="tag">msqrt</span>&gt;, &lt;<span class="tag">mroot</span>&gt;, &lt;<span class="tag">mfenced</span>&gt;, &lt;<span class="tag">maction</span>&gt;, &lt;<span class="tag">mpadded</span>&gt;, etc);</li> <li>the support of the <span class="attribute">scriptminsize</span>, i.e., is the user-desired smallest font-size. Without this, the rendering would become unreadable in hierarchies of scriptlevel contexts.</li> <li>bug fixing, etc.</li> </ul> </li>
</ul>
<h3 id="Builds">Builds</h3>
<p>MathML is not yet part of the default build in Mozilla. This has prompted some contributors to keep a watchful eye on the MathML code to ensure that it compiles successfully in the milestone tarballs, and to <a class="external" href="http://www-archive.mozilla.org/build/distribution.html">distribute MathML-enabled binaries</a>. Moreover, automated nightly builds with MathML enabled can now be downloaded at:</p>
<ul> <li><a class="external" href="http://www.calm.hw.ac.uk/mathml/mozilla-mathml-win32-latest.zip"> http://www.calm.hw.ac.uk/mathml/mozilla-mathml-win32-latest.zip</a> (for Win32)</li> <li><a class="external" href="http://dymaxion.org/projects/mozilla/index.shtml"> http://dymaxion.org/projects/mozilla/index.shtml</a> (for Linux).</li>
</ul>
<p>Because no major browser supports MathML as yet, MathML content is scarce on the web. But as more people try out the Mozilla code, they produce additional practical <a class="external" href="http://www.maths.ox.ac.uk/%7Egartside/mathzilla/">examples</a> to <a class="external" href="http://bugzilla.mozilla.org/showattachment.cgi?attach_id=7367">showcase</a> the capabilities of the MathML renderer and generate interest. Thus, the process feeds upon itself.</p>
<h2 id="Taking_Stock">Taking Stock</h2>
<h3 id="Strengths">Strengths</h3>
<ul> <li><strong>3S</strong> <ul> <li><strong>Scope</strong> - Except the unfinished &lt;<span class="tag">mtable</span>&gt;, and the alignment tags &lt;<span class="tag">malignmark</span>/&gt; and &lt;<span class="tag">maligngroup</span>/&gt;, the MathML engine supports all Presentation markup (modulo bugs!). The use of TeX rendering rules has led to a rendering of high quality. Furthermore, font problems that were a heavy plight on the project at the beginning have been lifted.<br> <br> The project is first concentrating on Presentation markup. MathML is intended to be generated by software, and generators such as <a class="external" href="http://hutchinson.belmont.ma.us/tth/mml/">TtM</a> and <a class="external" href="http://www.cis.ohio-state.edu/%7Egurari/TeX4ht/mn.html">TeX4ht</a> appear to be only generating Presentation markup at the moment. In any case, the lack of current support for Content markup doesn't stand as a severe limitation since Content markup can be transformed to Presentation markup.</li> <li><strong>Size</strong> - As a result of building upon the solid foundation of Gecko, the overhead of the MathML code is proving very small (this is for the rendering part --the editing and transformation parts are unknown).</li> <li><strong>Speed</strong> - As fast as Gecko permits --with the caveat that the formatting of MathML is more expensive than standard HTML by far. This is due to the accurate measurements and fine placements that have to be done. Moreover MathML is highly verbose and documents with lots of maths tend to be large.</li> </ul> </li> <li><strong>DOM</strong><br> Although MathML 2.0 has some MathML specific additions to the DOM, MathML 1.0 doesn't mention the DOM (the DOM as we know it today wasn't there at the time MathML 1.0 was taking shape). Hence any capabilities with the current Gecko's XML DOM and JavaScript are major bonuses to the MathML engine.</li> <li><strong>CSS</strong><br> The support of CSSx in Mozilla means that authors can use (and sadly even <a class="external" href="http://bugzilla.mozilla.org/show_bug.cgi?id=27086">misuse</a>) them in MathML.</li> <li><strong>Special effects</strong><br> While not part of the MathML specification, the complex Mozilla framework offers the ability to seamlessly mix other markups within MathML (e.g., still or animated images, XHTML/XML in general, <a class="external" href="http://www-archive.mozilla.org/projects/svg/">SVG</a> to draw diagrams and graphs, etc). This enables to get special effects that would otherwise be impossible.</li>
</ul>
<h3 id="Weaknesses">Weaknesses</h3>
<ul> <li><a name="style"><strong>Inline style</strong><br> The inline <span class="attribute">style</span> attribute which is part of MathML 1.0 is missing in the current code. Furthermore, the following style-related attributes are not supported: <span class="attribute">fontfamily=</span>".", <span class="attribute">fontsize=</span>".", <span class="attribute">color=</span>".". These attributes cannot easily be supported at the frame construction level where MathML frames are created. And it is impossible to enumerate all the [fontfamily="."], [fontsize="."] and [color="."] in the <span class="module">mathml.css</span> file since the possibilities are endless. </a><p><a name="style"><img alt="trees.png" class="internal default" src="/@api/deki/files/6159/=trees.png"> In the </a><a class="external" href="http://www-archive.mozilla.org/docs/url_load.html">The Life Of An HTTP Request</a>, Alexander Larsson &lt;<a class=" link-mailto" href="mailto:alex@cendio.se" rel="freelink">alex@cendio.se</a>&gt; illustrated how data are fetched from the network and ultimately displayed on the screen. The formatting presently involved in the MathML code is hooked at the frame construction level. Handling the inline style properties (such as fontfamily, fontsize, color) at that level is a problem because the Style System has already sorted and combined style rules into subsets (or nsIStyleContext) relevant to each content node in the <a class="external" href="http://www-archive.mozilla.org/newlayout/doc/contentmodel.html">content model</a> (a raw form of the DOM). Every frame is bound to a nsIStyleContext which defines the stylistic characteristics of that frame. In addition, the Style System enables a frame to possibly hold additional leaf style contexts because they are useful in certain circumstances.</p> <p>The nsIStyleContext provides an interface for accessing the actual resolved style data in a suitable format throughout the code (nsStyleStruct). When there is a style property at the frame construction level that wasn't accounted for during the style resolution process, it is a problem because if a style data is altered, that would mean invalidating all the sorting that the style processor has done (and this without its knowledge), thereby corrupting the style tree.</p> <p>Another important task performed by the Style System is dynamic update. For example, if DOM + JavaScript manipulate style rules, the Style System will determines where the changes apply, resets (or replaces) style contexts that use those rules, rebuilds the style data, figures out the nature of the style changes (frame change, reflow, or visual --like color that doesn't require reformatting) and then initiates the appropriate changes.</p> <p>If is therefore better to add those style rules that are particular to MathML at the bottom in order to benefit from all this. The Gecko team plans to factor the content code and the frame construction code to allow greater extensibility in these areas. This is something that will certainly benefit the MathML and SVG efforts. If MathML style properties are supported at the bottom, the Style System will take care of them as it does with other properties. Moreover, this will allow for a better handling of the unconventional style switching induced by the &lt;<span class="tag">mi</span>&gt; tag and the <span class="attribute">scriptlevel</span> attribute.</p> Having described all this, it is important to draw authors' attention on the fact that Mozilla enables to achieve the desired stylistic effects (for fontsize, fontfamily, color, and much more) with standard CSS declarations (rather than attributes). Hence albeit inconvenient, this current limitation is not critical and can be circumvented.</li> <li><strong>&lt;<span class="tag">math</span>&gt; in HTML documents</strong><br> Mozilla MathML is rendered via XML/XHTML documents. But since most math authors are more familiar with HTML than XML/XHTML and are using generators that produce HTML documents, one of the most requested features at the moment is the ability to directly have a &lt;<span class="tag">math</span>&gt;...&lt;/<span class="tag">math</span>&gt; fragment inside a HTML document. This means a XML fragment within a HTML document. Mozilla does not yet support the cohabitation of XML and HTML within the same document.</li> <li><strong>Platform parity</strong><br> The fact that the <span class="function">GetBoundingMetrics()</span> function hasn't yet been ported on all of the main platforms means that printing of MathML and rendering of MathML on the MacOS are not yet working.</li>
</ul>
<h2 id="To_Do...">To Do...</h2>
<ul> <li><strong>&lt;<span class="tag">mtable</span>&gt;</strong> - Of course.</li> <li><strong>Platform parity</strong> - Port the <span class="function">GetBoundingMetrics()</span> on gfx/postscript (for printing) and on other platforms such as the MacOS.</li> <li><strong>Temp. hacks</strong> - Fix (or invalidate) the XXX comments. Ensure that incremental reflows are honored.</li> <li><strong>Save As Text</strong> - What does this means for MathML? Plain text... or better: ascii-art for the creative minds...</li> <li><strong>Save As <a class="external" href="http://www.tug.org/">TeX</a></strong> - Want to dive in the Mozilla code with the prospect of learning, and a clear focus to come up with something useful?</li> <li><strong>Content markup</strong> - Want to make MathML the first internal Mozilla application that feeds on <a class="external" href="http://lxr.mozilla.org/mozilla/source/extensions/transformiix/docs/readme.html">TransforMiiX</a>?</li> <li><strong>Linebreaking</strong> - Teach &lt;<span class="tag">mrow</span>&gt; to shrink-wrap around its content.</li> <li><strong>Embed the MathML renderer</strong> - The MathML code is not designed to be a standalone component of large size. On the contrary, it aims at fitting the Gecko architecture and at making an efficient use of the Gecko code. Thus it cannot be used in a separate library outside Gecko. However, on Win32, it is possible to embed Gecko in other applications via the <a class="external" href="http://www.iol.ie/%7Elocka/mozilla/mozilla.htm">Mozilla ActiveX control</a>. Practical applications of embedded Gecko with MathML enabled would be most welcome.</li> <li><strong>Surrogates (UTF-16)</strong> - MathML 2.0 involves plane 1 characters that are not yet supported by Mozilla, and David Carlisle noted that they break James Clark's sp suite of SGML tools, including the nsgmls parser system that is sitting behind most validation tools.</li> <li><strong>XML (&lt;<span class="tag">math</span>&gt;) in HTML documents</strong> - That would make many happy faces.</li> <li><strong>Editor aspect</strong> - Want to start authoring MathML in the <a class="external" href="http://www-archive.mozilla.org/editor/">editor</a>?</li> <li><strong>Much more</strong> - As usual...</li>
</ul>
<div class="originaldocinfo"> <h2 id="Original_Document_Information" name="Original_Document_Information">Original Document Information</h2> <ul> <li>Author: Roger B. Sidje</li> <li>Date: Apr 14 2000</li> </ul>
</div>