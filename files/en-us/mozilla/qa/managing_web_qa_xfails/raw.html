<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">One of the ongoing tasks of the Web QA department is managing xfails. This document will explain what xfails are, and describe the steps one can take to investigate and update them.</p>
<h2 id="What_is_an_XFail" style="margin-bottom: 0.5em; color: rgb(42, 126, 0); font-weight: normal; line-height: 1.2; font-size: 1.69em; font-family: Georgia, Times, serif; letter-spacing: normal;">What is an XFail?</h2>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;"><em>XFail</em> stands for <em>expected failure</em> and that’s exactly what it is: a test that is expected to fail. Why would we have a test that is expected to fail, you may ask? Usually it is because there is a known bug in the software that we are testing. The test exposes the bug and therefore will fail until the bug is fixed. When we find such a bug, and it is not expected to be fixed within a few hours, we mark the test as xfailed (we generally refer to this as <em>xfailing</em> the test), which indicates that it is expected to fail.</p>
<h2 id="What_is_an_XPass" style="margin-bottom: 0.5em; color: rgb(42, 126, 0); font-weight: normal; line-height: 1.2; font-size: 1.69em; font-family: Georgia, Times, serif; letter-spacing: normal;">What is an XPass?</h2>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;"><em>XPass</em> does not, as you might expect, stand for <em>expected pass</em>. It actually stands for <em>unexpected pass</em>, and it is essentially what an xfail becomes once the bug is fixed and the test starts passing again. We are alerted to the fact that we can <em>un-xfail</em> a test when it starts xpassing. When managing xfails we need to look at both xfails and xpasses. For the remainder of this document we will often mean both xfails and xpasses when using the term xfails, such as “managing xfails”.</p>
<h2 id="Where_to_Find_XFails" style="margin-bottom: 0.5em; color: rgb(42, 126, 0); font-weight: normal; line-height: 1.2; font-size: 1.69em; font-family: Georgia, Times, serif; letter-spacing: normal;">Where to Find XFails</h2>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">When managing xfails the first task is to find and identify them. To make that very easy we have developed a <a href="http://mozilla.github.io/mozwebqa-dashboard/#/xfails" style="color: rgb(227, 114, 14); font-weight: bold;">Web QA XFails Dashboard</a>. When you visit the dashboard you will see all of our automation projects listed, and every test in every project which is currently being xfailed or skipped. For the purposes of this discussion you may ignore the skipped tests. Each test that is either skipped or xfailed will appear as a row in a table similar to this:</p>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;"><a href="https://quality.mozilla.org/qmo_content/uploads/Screenshot-2014-03-04-14.30.20.png" style="color: rgb(227, 114, 14); font-weight: bold;"><img alt="" class="alignnone size-large wp-image-46803" height="87" src="https://quality.mozilla.org/qmo_content/uploads/Screenshot-2014-03-04-14.30.20-690x87.png" style="padding: 2px;" width="690"></a></p>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">As you can see, the source code for the test, in the Github repo, is linked to via the filename, and any tests that are xfailed will have a red box in the <em>Type</em> column.</p>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">Now that you’ve found an xfail to check, what’s next?</p>
<h2 id="Keeping_Track_of_Who_Is_Looking_at_What" style="margin-bottom: 0.5em; color: rgb(42, 126, 0); font-weight: normal; line-height: 1.2; font-size: 1.69em; font-family: Georgia, Times, serif; letter-spacing: normal;">Keeping Track of Who Is Looking at What</h2>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">It would be counterproductive if everyone looked into the same xfails at the same time, so when you start investigating xfails it is a good idea to record that fact. There is a document, called an etherpad, which we use to keep track of this information, and it can be found at <a href="https://etherpad.mozilla.org/webqa-xfails" style="color: rgb(227, 114, 14); font-weight: bold;">etherpad.mozilla.org/webqa-xfails</a>. Please access that etherpad and update it according to the instructions near the top. You can also drop into <a href="http://widget.mibbit.com/?settings=1b10107157e79b08f2bf99a11f521973&amp;server=irc.mozilla.org&amp;channel=%23mozwebqa" style="color: rgb(227, 114, 14); font-weight: bold;">#mozwebqa on irc.mozilla.org</a>and let someone know you’re doing the work, and then they can help you if you need any help.</p>
<h2 id="Doing_the_Detective_Work" style="margin-bottom: 0.5em; color: rgb(42, 126, 0); font-weight: normal; line-height: 1.2; font-size: 1.69em; font-family: Georgia, Times, serif; letter-spacing: normal;">Doing the Detective Work</h2>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">When investigating an xfail, you should complete the following steps:</p>
<h3 id="Identify_the_Bugzilla_bug_or_Github_Issue" style="margin-bottom: 0.25em; color: rgb(42, 126, 0); line-height: 1.2; font-size: 1.385em; font-family: Georgia, Times, serif; letter-spacing: normal;">Identify the Bugzilla bug or Github Issue</h3>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">Every xfailed test should have either a Buzilla bug number or Github issue number associated with it. For the remainder of this document we will use the word <em>bug</em> to mean either the Bugzilla bug or the Github issue associated with the xfailed test. You might be able to see this bug number right on the dashboard, as with the example above. If no bug number displays, click the name of the xfailed test and scroll to the error to see if a bug number is listed in the source code of the test. If a test is xfailed and it does not have a bug associated with it then that is a problem that should be addressed. Please open up a Github issue in the repo in which the test resides explaining the problem. For example, “Test test_name in file_name.py is xfailed without a corresponding bug”. That issue (the one you just opened) will then be investigated by someone.</p>
<h3 id="Run_the_Test" style="margin-bottom: 0.25em; color: rgb(42, 126, 0); line-height: 1.2; font-size: 1.385em; font-family: Georgia, Times, serif; letter-spacing: normal;">Run the Test</h3>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">We can learn a lot about an xfailed test by running it. Remember that an xfailed test is one that is expected to fail, but for a specific reason. We need to verify that the test is still failing for that reason. To do this you need to read through the associated bug to understand what behaviour the test exposes. Then run the test and watch it.</p>
<h4 id="If_the_Test_Fails" style="margin-bottom: 0.25em; color: rgb(42, 126, 0); line-height: 1.2; font-size: 1.2em; font-family: Georgia, Times, serif; letter-spacing: normal;">If the Test Fails</h4>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">Does it appear to fail because of the bug? If so then you are done with this test. The xfail is valid and you can move on to the next test. But if it fails for another reason then that’s an indication that the current xfail may not be valid. The xfail reason for the test should be changed to either replace the current reason with the new one, or, if it’s possible that the test is now failing for yet another reason, a new reason should be added. Depending on how comfortable you are with the following steps, and how much time you have, you may choose to simply open a new Github issue in the test’s repo explaining that the test is now failing for another reason. Please be sure to include details about what you did to determine this.</p>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">You may also choose to open a new bug which describes the new behaviour that is causing the test to fail, and then change or add to the xfail reason for the test by doing one of two things:</p>
<ol style="margin-bottom: 1.4em; margin-left: 1.6em; padding-left: 0px; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">
 <li style="margin-bottom: 0.25em; padding-bottom: 0px;">If you know how to do it, open a pull request which changes the source code of the test to provide the new bug number and reason. More information on Github Pull Requests can be found at <a href="https://help.github.com/articles/using-pull-requests" style="color: rgb(227, 114, 14); font-weight: bold;">Github’s Help Pages</a>.</li>
 <li style="margin-bottom: 0.25em; padding-bottom: 0px;">Otherwise, open a Github issue in the repo asking that the xfail reason for the test be changed or added to. Please include information about what you did when investigating the test that led you to conclude that the reason should be changed.</li>
</ol>
<h4 id="If_the_Test_Passes" style="margin-bottom: 0.25em; color: rgb(42, 126, 0); line-height: 1.2; font-size: 1.2em; font-family: Georgia, Times, serif; letter-spacing: normal;">If the Test Passes</h4>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">If the test passes then it might be an XPass, but we need to be sure. Check whether it is also currently passing on our CI server. You can do that yourself if you have access, or you can ask in <a href="http://widget.mibbit.com/?settings=1b10107157e79b08f2bf99a11f521973&amp;server=irc.mozilla.org&amp;channel=%23mozwebqa" style="color: rgb(227, 114, 14); font-weight: bold;">#mozwebqa on irc.mozilla.org</a> if you do not have access to the CI results. You should also check the bug to see if it is marked as resolved. If it is, this is another good indication that the test is likely xpassing. If it is not then perhaps something else is now allowing the test to pass, or maybe the bug has been fixed but it hasn’t been updated yet. Add a comment on the bug to explain what you’ve done and that the test now seems to be passing. If you believe that the test is now passing reliably and should be un-xfailed, you can do one of two things:</p>
<ol style="margin-bottom: 1.4em; margin-left: 1.6em; padding-left: 0px; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">
 <li style="margin-bottom: 0.25em; padding-bottom: 0px;">If you know how to do it, open a pull request which changes the test to no longer be xfailed. More information on Github Pull Requests can be found at <a href="https://help.github.com/articles/using-pull-requests" style="color: rgb(227, 114, 14); font-weight: bold;">Github’s Help Pages</a>.</li>
 <li style="margin-bottom: 0.25em; padding-bottom: 0px;">Otherwise, open a Github issue in the repo asking that the test be un-xfailed. Please include information about what you did when investigating the test that led you to conclude that it should be un-xfailed.</li>
</ol>
<h3 id="Choose_Another_Test_to_Investigate" style="margin-bottom: 0.25em; color: rgb(42, 126, 0); line-height: 1.2; font-size: 1.385em; font-family: Georgia, Times, serif; letter-spacing: normal;">Choose Another Test to Investigate</h3>
<p style="margin-bottom: 1.4em; color: rgb(51, 51, 51); font-family: Georgia, Times, serif; font-size: 12.7272720336914px; line-height: 18.176362991333px;">Continue checking tests from the current project until you have checked them all. Then report that you have completed the xfail review of the tests for Project ‘X’, and choose another project to look at.</p>