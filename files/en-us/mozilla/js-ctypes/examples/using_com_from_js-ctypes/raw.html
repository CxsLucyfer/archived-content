<section class="Quick_links" id="Quick_Links">
<ol>
 <li><a href="/en-US/docs/Mozilla/js-ctypes"><strong><em>js-ctypes</em></strong></a></li>
 <li class="toggle">
  <details><summary>Introduction</summary>
  <ol>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Debugging_Tips" title="Editorial review completed.">Debugging Tips</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Declaring_and_calling_functions" title="Functions are declared using the Library object's declare() method. Once declared, functions can be called using standard function syntax.">Declaring and Calling Functions</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Declaring_and_Using_Callbacks" title="C functions occasionally take function pointers as arguments, which are generally used as callbacks. In these cases, js-ctypes allows you to pass a regular JavaScript function as the callback. This is very powerful, since it allows native code to transparently call into JavaScript.">Declaring and Using Callbacks</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Declaring_types" title="The ctypes object offers a number of constructor methods that let you declare types. Every type is represented by a CType object, which, in turn, provides a constructor method you can call to define values of those types. Each type you declare using js-ctypes corresponds to a compatible C declaration.">Declaring types</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Memory_Management" title="If JS code creates a structure or an array, that memory will be valid as long as the JS object stays alive. Pointers to that memory must be carefully managed to make sure the underlying memory is still referenced.">Memory Management</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Standard_OS_Libraries" title="This article gives the names of standard libraries that can be accessed with js-ctypes. These libraries are what enable js-ctypes to work. The alternative to standard libraries is creating your own DLL (for Windows) or SO (for Linux) file with C functions that can be called from your add-on with js-ctypes. The DLL/SO/etc file you make must be shipped with your add-on. Standard libraries offer the advantage of not having to ship anything. They are already available on the operating system for you. You just need to supply the path to appropriate files and set up the proper types of values/arguments in the js-ctypes code. This article allows you to find out what types to give to values/arguments by supplying links to the documentation of the OS libraries.">Standard OS Libraries</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Type_conversion" title="In js-ctypes, data could be converted implicitly when passing to or returning from a FunctionType call, or setting pointer content, an array element or a struct field.">Type conversion</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Working_with_ArrayBuffers" title="An ArrayBuffer is a simply byte array. The js-ctypes equivalent is a ctypes.uint8_t.array(###) (ctypes.unsigned_char are also ctypes.uint8_t).">Working with ArrayBuffers</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/Working_with_data" title="Data types for use with js-ctypes are represented by CType objects. These are JavaScript constructors; as such, they're callable functions that you can use to create new CData objects of that type. There are several ways you can go about creating new CData objects.">Working with data</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Using_js-ctypes/ctypes.open" title="At the heart of js-ctypes is the ctypes.open() function. This must be called before any work can commence. There are two options:">ctypes.open</a></li>
  </ol>
  </details>
 </li>
 <li class="toggle">
  <details><summary>References</summary>
  <ol>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/ABI" title="This article describes the calling conventions with respect to js-ctypes while programming x86 and x86-64/x64/AMD64 architectures. A calling convention is an implementation-level (low-level) scheme regarding how subroutines receive parameters from their caller and how they revert."><code>ABI</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/ArrayType" title="ArrayType represents C arrays"><code>ArrayType</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/CData" title="A CData object represents a C value or function located in memory."><code>CData</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/CType" title="All data types declared using the js-ctypes API are represented by CType objects. These objects have assorted methods and properties that let you create objects of these types, find out information about them, and so forth. The specific properties and methods on each object vary depending on the data type represented."><code>CType</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/FunctionType" title=""><code>FunctionType</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/Int64" title="Because JavaScript doesn't currently include standard support for 64-bit integer values, js-ctypes offers the Int64 and UInt64 objects to let you work with C functions and data that need (or may need) values represented using a 64-bit data type."><code>Int64</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/Library" title="The Library object represents a native library loaded by the ctypes open() method. Its methods let you declare symbols exported by the library, and to manage the library."><code>Library</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/PointerType" title="Returns a new CType object describing a new pointer data type."><code>PointerType</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/StructType" title="Returns a CType object describing a new structure data type. This data type provides the ability to define and manipulate values of the C struct type."><code>StructType</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/UInt64" title="As JavaScript doesn't currently include standard support for 64-bit integer values, js-ctypes offers the Int64 and UInt64 objects to let you work with C functions and data that need (or may need) to use data represented using a 64-bit data type."><code>UInt64</code></a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/js-ctypes_reference/ctypes" title="The ctypes object contains methods and predefined data types used to create and manage a library."><code>ctypes</code></a></li>
  </ol>
  </details>
 </li>
 <li class="toggle">
  <details open><summary>Examples</summary>
  <ol>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Examples/Add_to_iPhoto" title="This extension for Mac OS X serves as a demonstration of how to use js-ctypes to call Mac OS X Carbon, Core Foundation, and other system frameworks from an extension written entirely in JavaScript.">Add to iPhoto</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Examples/Using_C_structs_and_pointers" title="In this example, we show how to use C structs and pointers with js-ctypes.">Using C struct and pointers</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Examples/Using_COM_from_js-ctypes" title="The Windows API mostly concerns itself with the interaction between the operating system and an application. For communication between the different Windows applications among themselves, Microsoft has developed a series of technologies alongside the main Windows API. This started out with Dynamic Data Exchange (DDE), which was superseded by Object Linking and Embedding (OLE) and later by the Component Object Model (COM), Automation Objects, ActiveX controls, and the .NET Framework.">Using COM from js-ctypes</a></li>
   <li><a href="/en-US/docs/Mozilla/js-ctypes/Examples/Using_Objective-C_from_js-ctypes" title="Objective-C has its own syntax, it cannot be written directly with js-ctypes. This guide explains how to convert Objective-C code into js-ctypes code.">Using Objective-C from js-ctypes</a></li>
  </ol>
  </details>
 </li>
</ol>
</section>

<p>The Windows API mostly concerns itself with the interaction between the operating system and an application. For communication between the different Windows applications among themselves, Microsoft has developed a series of technologies alongside the main Windows API. This started out with <a href="http://en.wikipedia.org/wiki/Dynamic_Data_Exchange" title="Dynamic Data Exchange">Dynamic Data Exchange</a> (DDE), which was superseded by <a href="http://en.wikipedia.org/wiki/Object_Linking_and_Embedding" title="Object Linking and Embedding">Object Linking and Embedding</a> (OLE) and later by the <a href="http://en.wikipedia.org/wiki/Component_Object_Model" title="Component Object Model">Component Object Model</a> (COM), <a href="http://en.wikipedia.org/wiki/OLE_Automation" title="OLE Automation">Automation Objects</a>, <a href="http://en.wikipedia.org/wiki/ActiveX" title="ActiveX">ActiveX controls</a>, and the <a href="http://en.wikipedia.org/wiki/.NET_Framework" title=".NET Framework">.NET Framework</a>.</p>

<p>COM is C++ and it cannot be written directly with js-ctypes. This documentaion explains how to convert the COM C++ code into js-ctypes code.</p>

<div class="note">
<p>Basis and reference for this article <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=738501">Bugzilla :: Bug 738501 - Implement ability to create Windows shortcuts from javascript - Comment 4 </a></p>
</div>

<div class="note">
<p>Relavent topic <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=505907">Bugzilla :: Bug 505907 - Support C++ calling from JSctypes</a></p>
</div>

<h2 id="Converting_COM_code_to_C_code">Converting COM code to C code</h2>

<p>To convert COM code to js-ctypes, we need to write C++ VTable pointers in C. After that, we can pass a pointer .</p>

<h3 id="Speech_Synthesis_Example">Speech Synthesis Example</h3>

<p>Let's start with following C++ code, which invokes <a href="https://msdn.microsoft.com/en-us/library/ee125663%28v=vs.85%29.aspx">Microsoft Speech API</a> and says "Hello, Firefox!" with system default voice, then wait until the speaking done.</p>

<pre class="brush: cpp">#include &lt;sapi.h&gt;

int main(void)
{
    if (SUCCEEDED(CoInitialize(NULL)))
    {
        ISpVoice* pVoice = NULL;
        HRESULT hr = CoCreateInstance(CLSID_SpVoice, NULL, CLSCTX_ALL,
                                      IID_ISpVoice, (void**)&amp;pVoice);

        if (SUCCEEDED(hr))
        {
            pVoice-&gt;Speak(L"Hello, Firefox!", SPF_DEFAULT, NULL);

            pVoice-&gt;Release();
        }
    }

    // MSDN documentation says that even if CoInitalize fails, CoUnitialize
    // must be called
    CoUninitialize();

    return 0;
}
</pre>

<p>To run the code, save it as <code>test.cpp</code>, and run following command in the directory (needs Visual Studio).</p>

<pre class="brush: cpp">$ cl ole32.lib test.cpp</pre>

<h3 id="vtable">vtable</h3>

<div class="note">
<p>Needs vtable description here.</p>
</div>

<p>The order of the vtable is very critical. When used from C or js-ctypes, the order of the vtable methods should match the order of the C++ vtable.</p>

<h3 id="__stdcall_and___cdecl">__stdcall and __cdecl</h3>

<div class="note">
<p>Needs __stdcall and __cdecl (CALLBACK_ABI) description here.</p>
</div>

<h3 id="Call_by_reference">Call by reference</h3>

<div class="note">
<p>Needs C++ reference (&amp;) and C pointer (*) description here.</p>
</div>

<h3 id="Converted_C_code">Converted C code</h3>

<p>Now we can translate whole code into C syntax.</p>

<pre class="brush: cpp">#include &lt;sapi.h&gt;

int main(void)
{
    if (SUCCEEDED(CoInitialize(NULL)))
    {
        struct ISpVoice* pVoice = NULL;
        HRESULT hr = CoCreateInstance(&amp;CLSID_SpVoice, NULL, CLSCTX_ALL,
                                      &amp;IID_ISpVoice, (void**)&amp;pVoice);
        if (SUCCEEDED(hr))
        {
            pVoice-&gt;lpVtbl-&gt;Speak(pVoice, L"Hello, Firefox!", 0, NULL);

            pVoice-&gt;lpVtbl-&gt;Release(pVoice);
        }
    }

    // MSDN documentation says that even if CoInitalize fails, CoUnitialize
    // must be called
    CoUninitialize();

    return 0;
}
</pre>

<p>To run the code, save it as <code>test.c</code>, and run following command in the directory.</p>

<pre class="brush: cpp">$ cl ole32.lib test.c
</pre>

<h3 id="C_code_with_pseudo_struct">C code with pseudo struct</h3>

<div class="note">
<p>Needs pseudo struct description here.</p>
</div>

<pre class="brush: cpp">#include &lt;sapi.h&gt;

struct MyISpVoiceVtbl;
struct MyISpVoice {
    struct MyISpVoiceVtbl* lpVtbl;
};
struct MyISpVoiceVtbl {
    /* start inherit from IUnknown */
    void* QueryInterface;
    void* AddRef;
    ULONG (__stdcall *Release)(struct MyISpVoice*);
    /* end inherit from IUnknown */
    /* start inherit from ISpNotifySource */
    void* SetNotifySink;
    void* SetNotifyWindowMessage;
    void* SetNotifyCallbackFunction;
    void* SetNotifyCallbackInterface;
    void* SetNotifyWin32Event;
    void* WaitForNotifyEvent;
    void* GetNotifyEventHandle;
    /* end inherit from ISpNotifySource */
    /* start inherit from ISpEventSource */
    void* SetInterest;
    void* GetEvents;
    void* GetInfo;
    /* end inherit from ISpEventSource */
    /* start ISpVoice */
    void* SetOutput;
    void* GetOutputObjectToken;
    void* GetOutputStream;
    void* Pause;
    void* Resume;
    void* SetVoice;
    void* GetVoice;
    HRESULT (__stdcall *Speak)(struct MyISpVoice*, LPCWSTR pwcs, DWORD dwFlags,
                               ULONG* pulStreamNumber);
    void* SpeakStream;
    void* GetStatus;
    void* Skip;
    void* SetPriority;
    void* GetPriority;
    void* SetAlertBoundary;
    void* GetAlertBoundary;
    void* SetRate;
    void* GetRate;
    void* SetVolume;
    void* GetVolume;
    void* WaitUntilDone;
    void* SetSyncSpeakTimeout;
    void* GetSyncSpeakTimeout;
    void* SpeakCompleteEvent;
    void* IsUISupported;
    void* DisplayUI;
    /* end ISpVoice */
};

int main(void)
{
    if (SUCCEEDED(CoInitialize(NULL)))
    {
        struct MyISpVoice* pVoice = NULL;
        HRESULT hr = CoCreateInstance(&amp;CLSID_SpVoice, NULL, CLSCTX_ALL,
                                      &amp;IID_ISpVoice, (void**)&amp;pVoice);
        if (SUCCEEDED(hr))
        {
            pVoice-&gt;lpVtbl-&gt;Speak(pVoice, L"Hello, Firefox!", SPF_DEFAULT,
                                  NULL);

            pVoice-&gt;lpVtbl-&gt;Release(pVoice);
        }
    }

    // MSDN documentation says that even if CoInitalize fails, CoUnitialize
    // must be called
    CoUninitialize();

    return 0;
}
</pre>

<h2 id="Converting_C_code_to_js-ctypes_code">Converting C code to js-ctypes code</h2>

<p>Now we have working C code. It could be converted into js-ctypes in almost straightforward way.</p>

<h3 id="CLSID_and_IID">CLSID and IID</h3>

<div class="note">
<p>Needs CLSID and IID of SpVoice and ISpVoice description here.</p>
</div>

<h3 id="COM_types_and_functions">COM types and functions</h3>

<div class="note">
<p>Needs COM types (GUID) and functions (CoInitialize etc) description here.</p>
</div>

<h3 id="Converted_js-ctypes_code">Converted js-ctypes code</h3>

<p>Here's converted code.</p>

<div class="warning">This example uses busy loop and thus Firefox won't respond until the speaking is done. If this code were used in a production add-on, then to avoid Firefox locking up,  run this code from a <a href="/en-US/docs/Web/API/ChromeWorker">ChromeWorker</a>.</div>

<pre class="brush: js">let { ctypes } = Components.utils.import("resource://gre/modules/ctypes.jsm", {});

// SOME GROUNDWORK
let is64bit;
if (ctypes.voidptr_t.size == 4 /* 32-bit */) {
    is64bit = false;
} else if (ctypes.voidptr_t.size == 8 /* 64-bit */) {
    is64bit = true;
}
let WINABI = is64bit ? ctypes.default_abi : ctypes.winapi_abi;
let CALLBACK_ABI = is64bit ? ctypes.default_abi : ctypes.stdcall_abi;

// LIBRARIES
let lib = ctypes.open('ole32.dll');

// TYPES
// Simple Types
let BYTE = ctypes.unsigned_char;
let DWORD = ctypes.unsigned_long;
let LONG = ctypes.long;
let LPVOID = ctypes.voidptr_t;
let VOID = ctypes.void_t;
let ULONG = ctypes.unsigned_long;
let USHORT = ctypes.unsigned_short;
let WCHAR = ctypes.jschar;

// Advanced Types - based on simple types
let HRESULT = LONG;
let LPCWSTR = WCHAR.ptr;

// Guess Types - these just work I couldnt find a proper defintion for it
let LPUNKNOWN = ctypes.voidptr_t;

// STRUCTURES
// Simple Structures
let GUID = ctypes.StructType('GUID', [
  { 'Data1': ULONG },
  { 'Data2': USHORT },
  { 'Data3': USHORT },
  { 'Data4': BYTE.array(8) }
]);

// Advanced Structures
let CLSID = GUID;
let IID = GUID;

// Super Advanced Structures
let REFIID = IID.ptr;
let REFCLSID = CLSID.ptr;

// VTABLES
let ISpVoiceVtbl = ctypes.StructType('ISpVoiceVtbl');
let ISpVoice = ctypes.StructType('ISpVoice', [{
    'lpVtbl': ISpVoiceVtbl.ptr
}]);
ISpVoiceVtbl.define([
    // start inherit from IUnknown
    { 'QueryInterface': ctypes.voidptr_t },
    { 'AddRef': ctypes.voidptr_t },
    { 'Release': ctypes.FunctionType(CALLBACK_ABI,
        ULONG,            // return
        [
            ISpVoice.ptr
        ]).ptr
    },
    // end inherit from IUnknown
    // start inherit from ISpNotifySource
    // can set to ctypes.voidptr_t if arent going to use it
    { 'SetNotifySink': ctypes.voidptr_t },
    { 'SetNotifyWindowMessage': ctypes.voidptr_t },
    { 'SetNotifyCallbackFunction': ctypes.voidptr_t },
    { 'SetNotifyCallbackInterface': ctypes.voidptr_t },
    { 'SetNotifyWin32Event': ctypes.voidptr_t },
    { 'WaitForNotifyEvent': ctypes.voidptr_t },
    { 'GetNotifyEventHandle': ctypes.voidptr_t },
    // end inherit from ISpNotifySource
    // start inherit from ISpEventSource
    { 'SetInterest': ctypes.voidptr_t },
    { 'GetEvents': ctypes.voidptr_t },
    { 'GetInfo': ctypes.voidptr_t },
    // end inherit from ISpEventSource
    // start ISpVoice
    { 'SetOutput': ctypes.voidptr_t },
    { 'GetOutputObjectToken': ctypes.voidptr_t },
    { 'GetOutputStream': ctypes.voidptr_t },
    { 'Pause': ctypes.voidptr_t },
    { 'Resume': ctypes.voidptr_t },
    { 'SetVoice': ctypes.voidptr_t },
    { 'GetVoice': ctypes.voidptr_t },
    { 'Speak': ctypes.FunctionType(CALLBACK_ABI,
        HRESULT,            // return
        [
            ISpVoice.ptr,
            LPCWSTR,        // *pwcs
            DWORD,          // dwFlags
            ULONG           // *pulStreamNumber
        ]).ptr
    },
    { 'SpeakStream': ctypes.voidptr_t },
    { 'GetStatus': ctypes.voidptr_t },
    { 'Skip': ctypes.voidptr_t },
    { 'SetPriority': ctypes.voidptr_t },
    { 'GetPriority': ctypes.voidptr_t },
    { 'SetAlertBoundary': ctypes.voidptr_t },
    { 'GetAlertBoundary': ctypes.voidptr_t },
    { 'SetRate': ctypes.voidptr_t },
    { 'GetRate': ctypes.voidptr_t },
    { 'SetVolume': ctypes.voidptr_t },
    { 'GetVolume': ctypes.voidptr_t },
    { 'WaitUntilDone': ctypes.voidptr_t },
    { 'SetSyncSpeakTimeout': ctypes.voidptr_t },
    { 'GetSyncSpeakTimeout': ctypes.voidptr_t },
    { 'SpeakCompleteEvent': ctypes.voidptr_t },
    { 'IsUISupported': ctypes.voidptr_t },
    { 'DisplayUI': ctypes.voidptr_t }
    // end ISpVoice
]);

// FUNCTIONS
// http://msdn.microsoft.com/en-us/library/windows/desktop/ms695279%28v=vs.85%29.aspx
let CoInitializeEx = lib.declare('CoInitializeEx', WINABI,
    HRESULT,    // result
    LPVOID,     // pvReserved
    DWORD       // dwCoInit
);

// http://msdn.microsoft.com/en-us/library/windows/desktop/ms688715%28v=vs.85%29.aspx
let CoUninitialize = lib.declare('CoUninitialize', WINABI,
    VOID    // return
);

// http://msdn.microsoft.com/en-us/library/windows/desktop/ms686615%28v=vs.85%29.aspx
let CoCreateInstance = lib.declare('CoCreateInstance', WINABI,
    HRESULT,        // return
    REFCLSID,       // rclsid
    LPUNKNOWN,      // pUnkOuter
    DWORD,          // dwClsContext
    REFIID,         // riid
    LPVOID          // *ppv
);

// HELPER FUNCTIONS
function checkHRESULT(hr /*primative HRESULT*/, funcName /*jsStr*/) {
    // primative because thats what is returned by declared functions that
    // return HRESULT
    hr = hr.toString(); // makes it primative
    if (hr &lt; 0) {
        console.error('HRESULT', hr, 'returned from function ', funcName
                      /*, 'getStrOfResult:', getStrOfResult(hr)*/);
        throw new Error('HRESULT ' + hr + ' returned from function ' + funcName);
    }
}

let CLSIDFromArr = IIDFromArr = function(jsArr_pieces) {
    let guid = GUID(); // CLSID and IID are same they are GUID

    guid.Data1 = parseInt(jsArr_pieces[0], 16);
    guid.Data2 = parseInt(jsArr_pieces[1], 16);
    guid.Data3 = parseInt(jsArr_pieces[2], 16);

    let j = 2;
    for (let i=0; i&lt;8; i++) {
        j++;
        guid.Data4[i] = parseInt(jsArr_pieces[j], 16);
    };

    return guid;
}

// CONSTANTS
let COINIT_MULTITHREADED = 0;
let COINIT_APARTMENTTHREADED = 2;
let CLSCTX_ALL = 0x17;
let CLSID_SpVoice = CLSIDFromArr(['0x96749377', '0x3391', '0x11D2',
                                  '0x9E', '0xE3', '0x00', '0xC0',
                                  '0x4F', '0x79', '0x73', '0x96']);
let IID_ISpVoice = IIDFromArr(['0x6C44DF74', '0x72B9', '0x4992',
                               '0xA1', '0xEC', '0xEF', '0x99',
                               '0x6E', '0x04', '0x22', '0xD4']);
let SPF_DEFAULT = 0;

function main() {
    let spVoice;
    let spVoicePtr;
    try {
        // MSDN Docs tell us ot use CoInitEx instead of CoInit, and default is 0
        // which is COINIT_MULTITHREADED but it wouldnt work so I used
        // COINIT_APARTMENTTHREADED and it worked checkHRESULT would throw a bad
        // HRESULT of RPC_E_CHANGED_MODE which is 0x80010106 which is
        // -2147417850.
        primative_hr = CoInitializeEx(null, COINIT_APARTMENTTHREADED);
        checkHRESULT(primative_hr, "CoInitializeEx");

        spVoicePtr = ISpVoice.ptr();
        primative_hr = CoCreateInstance(CLSID_SpVoice.address(), null,
                                        CLSCTX_ALL, IID_ISpVoice.address(),
                                        spVoicePtr.address());
        checkHRESULT(primative_hr, "CoCreateInstance");
        spVoice = spVoicePtr.contents.lpVtbl.contents;

        let aText = 'Hello Firefox!';
        let aFlags = SPF_DEFAULT;
        primative_hr = spVoice.Speak(spVoicePtr, aText, aFlags, 0);
        checkHRESULT(primative_hr, "CoCreateInstance");

    } catch (ex) {
        console.error('ex occured:', ex);
    } finally {
        if (spVoice) {
            spVoice.Release(spVoicePtr);
        }
        CoUninitialize();
    }
}
main();

lib.close();</pre>

<h2 id="Other_Examples">Other Examples</h2>

<ul>
 <li><code><a href="http://stackoverflow.com/a/27892227/1828637">SHGetPropertyStoreForWindow </a></code>- This examples shows that CoInit is not needed, some WinAPI functions return the interface. This example uses <code>IPropertyStore::SetValue</code> to change the System.UserModelApp.ID of an open Firefox window.</li>
 <li><code><a href="https://github.com/FunkMonkey/Loomo/blob/06a5881a4f520ede092059a4115bf117568b914f/Loomo/chrome/content/modules/Utils/COM/IShellItem.jsm">IShellItem</a></code></li>
 <li><code><a href="https://github.com/FunkMonkey/Loomo/blob/06a5881a4f520ede092059a4115bf117568b914f/Loomo/chrome/content/modules/Utils/COM/IFileOperation.jsm">IFileOperation</a></code></li>
 <li><code>IShellLink</code> &amp; <code>IPersistFile</code> - Create shortcut files.
  <ul>
   <li><a href="https://github.com/west-mt/ssbrowser/blob/452e21d728706945ad00f696f84c2f52e8638d08/chrome/content/modules/WindowsShortcutService.jsm#L251">Example A</a> - Based on <a href="https://bug738501.bugzilla.mozilla.org/attachment.cgi?id=608538">Bugzilla :: Bug 738501 - Attachement 608538</a></li>
   <li><a href="https://github.com/Noitidart/_scratchpad/blob/e5b61dda3f8c4e8554138690f5b3142a8c8d677e/IShellLink%20IPersistFile%20VTBL%20and%20COM.js">Exmaple B</a> - Based on Example A</li>
  </ul>
 </li>
 <li><a href="https://github.com/Noitidart/_scratchpad/blob/45d16d1b9cfb8253858ca9a2b200d252070d429d/IShellLink%20IPersistFile%20WITH%20IPropertyStore%20ctypes.js"><code>IShellLink</code> &amp; <code>IPersistFile</code> &amp; <code>IPropertyStore</code></a> - Uses IPropertyStore to set and get the System.UserModelApp.ID on shortcut files.</li>
</ul>