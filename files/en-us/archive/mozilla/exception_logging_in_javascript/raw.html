<p></p>
<p>In versions of Firefox prior to Firefox 3, all JavaScript exceptions were always logged into the <a href="en/Error_Console">Error Console</a> if they remained unhandled at the time execution returned back into C++ code. As a result, if, for example, C++ code called a JavaScript component, which threw an exception, that exception would be logged to the console before control was returned to the C++ caller.</p>
<p>This had the unintended consequence of logging "expected" errors at length into the console. JavaScript code is sometimes designed to throw exceptions to report a result condition back to the C++ caller. These might be perfectly normal circumstances, but the exceptions were dutifully logged nonetheless.</p>
<h3 id="Exception_reporting_in_Firefox_3" name="Exception_reporting_in_Firefox_3">Exception reporting in Firefox 3</h3>
<p>Firefox 3 improves reporting of unhandled exceptions by establishing a set of rules that determines whether or not an exception is worth reporting:</p>
<ol>
 <li>Any methods on interfaces annotated with the <code>[function]</code> attribute in IDL (see, for example, <code><a class="external" href="http://mxr.mozilla.org/seamonkey/source/dom/public/idl/events/nsIDOMEventListener.idl">nsIDomEventListener</a></code>) that throw exceptions always report those exceptions into the Error Console.</li>
 <li>Any exceptions that are generated by <a href="en/XPConnect">XPConnect</a> -- that is, those exceptions whose result codes are defined in <a class="external" href="http://mxr.mozilla.org/seamonkey/source/js/src/xpconnect/idl/nsIXPConnect.idl">nsIXPConnect.idl</a> -- are always logged into the Error Console.</li>
 <li>The <code>NS_NOINTERFACE</code> error is never reported when returned by a JavaScript object's <code>QueryInterface()</code> method on the <code>nsISupports</code> interface.</li>
 <li>The <code>NS_NOINTERFACE</code> error is never reported when returned by a JavaScript object's <code>GetInterface()</code> method on the <code>nsIInterfaceRequestor</code> interface.</li>
 <li>All other errors are reported when the last JavaScript frame on the stack returns to a C++ caller without handling the exception.</li>
</ol>
<p>That last point deserves clarification. Consider this call chain:</p>
<p><img alt="Image:Exception-logging.png"></p>
<p>Here we see C++ code calling JavaScript, which calls back into C++, which then calls back into JavaScript.</p>
<p>If the JavaScript in frame 4 throws an exception, the exception is returned as an error code to the C++ in frame 3. No exception will be logged to the <a href="en/Error_Console">Error Console</a> in this case. That C++ may handle the error, generate a different error, or simply pass it straight back to the JS in frame 2. If the JavaScript in frame 2 either receives an exception from frame 3 or generates its own exception, and that exception remains unandled, then the exception will always be logged to the <a href="en/Error_Console">Error Console</a> before control returns to the C++ in frame 1.</p>
<p>In other words, all unhandled JavaScript exceptions (except those in rules 3 and 4 above) will be logged before control returns to the outermost C++ caller.</p>
<h3 id="Forcing_logging_of_exceptions_in_inner_JS_frames" name="Forcing_logging_of_exceptions_in_inner_JS_frames">Forcing logging of exceptions in inner JS frames</h3>
<p>Sometimes you might actually want to see all exceptions from inner JavaScript frames logged (in the call chain above that would be when an exception is unhandled in frame 4). Note that the following will have no effect on the NS_NOINTERFACE exceptions outlined in rules 3 and 4 above - those exceptions will not be reported in any case.</p>
<p>There are two ways you can accomplish this.</p>
<p>First, you can set the boolean preference <code>dom.report_all_js_exceptions</code>. If this preference is <code>true</code>, all exceptions from inner frames will be logged.</p>
<p>Alternatively, you can set the environment variable <code>MOZ_REPORT_ALL_JS_EXCEPTIONS</code>. It doesn't matter what value you set this to (it can even be 0). If the variable exists, all exceptions from inner frames will be reported.</p>
<h3 id="See_also" name="See_also">See also</h3>
<ul>
 <li><a href="en/Error_Console">Error Console</a></li>
 <li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=415498" title="FIXED: Some errors not displayed in Error Console when using addEventListener">bugÂ 415498</a></li>
</ul>