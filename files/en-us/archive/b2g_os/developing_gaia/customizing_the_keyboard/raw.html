<p></p><section class="Quick_links" id="Quick_Links">

<ol>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_build_process_summary">B2G OS build process summary</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/B2G_OS_build_prerequisites">Build prerequisites</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Preparing_for_your_first_B2G_build">Preparing for your first build</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building">Building B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_installer_add-on">B2G installer add-on</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Building_for_Flame_on_OS_X">Building B2G OS for Flame on Mac OS X</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Choosing_how_to_run_Gaia_or_B2G">Choosing how to run Gaia or B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Compatible_Devices">Compatible Devices</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Installing_on_a_mobile_device">Installing B2G OS on a mobile device</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_update_packages">Creating and applying B2G OS update packages</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building/FOTA_community_builds">Building and installing FOTA community builds</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_Build_Variables_Reference_Sheet">B2G build variables reference sheet</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting B2G OS</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/basics">Porting basics</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/Porting_on_CyanogenMod">Porting on CyanogenMod</a></li>
  </ol>
 </li>
 <li data-default-state="open"><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Running_the_Gaia_codebase">Running the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Mulet">Run Gaia on desktop using Mulet</a></li>

   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Understanding_the_Gaia_codebase">Understanding the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Making_Gaia_code_changes">Making Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Testing_Gaia_code_changes">Testing Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Submitting_a_Gaia_patch">Submitting a Gaia patch</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Build_System_Primer">Gaia build system primer</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Different_ways_to_run_Gaia">Different ways to run Gaia</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/make_options_reference">Make options reference</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Gaia_tools_reference">Gaia tools reference</a></li>
  </ol>
 </li>
 <li><a href="/en-US/docs/Mozilla/B2G_OS/API">B2G OS APIs</a></li>
</ol>
</section><p></p>

<div class="summary">
<p>This document explains how to add custom keyboard layouts containing their own languages/scripts to Firefox OS v1.2+.</p>
</div>

<h2 id="Status_of_the_Gaia_Built-in_Keyboard_app_system_architecture">Status of the Gaia Built-in Keyboard app &amp; system architecture</h2>

<p>Two major keyboard features have been implemented in Firefox OS, as of October 2013.</p>

<ul>
 <li>A build flag to turn keyboard/spellcheck dictionaries to include in the build in the default Gaia Keyboard app on and off (see <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=884752" title="FIXED: keyboard build-time customization">bug 884752</a>).</li>
 <li>An OS-level feature that allows users to install third-party keyboard apps from the Firefox Marketplace. This will be available starting from Firefox OS v2.0. See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=816869" title="FIXED: [Meta] Enable third-party keyboards">bug 816869</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=964670" title="FIXED: [Keyboard][User Story] Enable 3rd party keyboard framework with OOP">bug 964670</a> for details.</li>
</ul>

<p>To include a new keyboard layout on your phone, you could put a custom layout file in Gaia and build the keyboard app using a build config, or develop your own keyboard app and install it on the phone. Let's have a look at how to do each of these.</p>

<h2 id="Developing_your_own_keyboard_app">Developing your own keyboard app</h2>

<p>You can use Gaia's built-in keyboard app as a template, or fork it. The basic ideas are:</p>

<ul>
 <li>In the manifest file, declare your app as having a role of <code>input</code> in the <a href="/en-US/Apps/Build/Manifest#role"><code>role</code></a> property.</li>
 <li>Make sure you have the <code>input</code> permission specified in the <a href="/en-US/Apps/Build/Manifest#permissions"><code>permissions</code></a> property.</li>
</ul>

<p>After that, you can install your keyboard, and it will show up on the bottom half of the screen whenever the user is focused to an input field. The space issues that arise from this can be dealt with by:</p>

<ul>
 <li>Using the old, classic <code>window.resizeTo</code> to update the area your app should occupy.</li>
 <li>Using the new, shiny <code>navigator.mozInputMethod</code> API to mutate the content of the input given; see the <a href="http://dxr.mozilla.org/mozilla-central/source/dom/webidl/InputMethod.webidl">WebIDL of the API</a> for details. Many of these methods output the same characters but generate different events (<a href="/en-US/docs/Web/API/KeyboardEvent">KeyboardEvent</a>, <a href="/en-US/docs/Web/API/CompositionEvent">CompositionEvent</a>, etc), so please ensure you are <a href="https://wiki.mozilla.org/WebAPI/KeboardIME#Use_cases_for_each_of_the_methods">using the right method for your use cases</a>.</li>
</ul>

<div class="note">
<p><strong>Note</strong>: The <a href="https://github.com/mozilla-b2g/gaia/tree/master/dev_apps/test-keyboard-app">LOL Keyboard</a> demo should help you understand better how keyboard apps are constructed, and serve as a template for your own keyboard apps.</p>
</div>

<h2 id="Including_a_custom_layout_in_the_Gaia_keyboard_app">Including a custom layout in the Gaia keyboard app</h2>

<ol>
 <li>See the <a href="https://github.com/mozilla-b2g/gaia/blob/master/apps/keyboard/CONFIGURE">keyboard CONFIGURE details</a> for more information. Depending on the language you might want to add a dictionary, or include an interactive IME (for Asian languages).</li>
 <li>If you add layouts for a newly-supported language, you may want to add them as default layouts for that language in <a href="https://github.com/mozilla-b2g/gaia/blob/master/build/config/keyboard-layouts.json">build/config/keyboard-layouts.json</a>.</li>
</ol>

<h3 id="Asian_IME">Asian IME</h3>

<p>East Asian languages (<a href="https://en.wikipedia.org/wiki/CJK">Chinese, Japanese, and Korean</a>) use a fairly complex script that involves thousands of characters. As there is no way to put thousands of keys on a hardware or software keyboard, users rely on an indexing program called <a href="https://en.wikipedia.org/wiki/Input_method">input method editor</a>, or IME for short, to convert a series of symbols into selections of characters.<br>
 <br>
 How symbols should be converted and how "smart" the IME should be depends on the method chosen, the implementation itself, and often <a href="https://en.wikipedia.org/wiki/Natural_language_processing">NLP science</a>, which is outside the scope of this document. To conserve memory, it is advised that data should be compiled into a binary blob and read out as an array buffer; complex JSON structures will not work on actual devices.</p>

<h4 id="IME_interface_in_Gaia_keyboard_app">IME interface in Gaia keyboard app</h4>

<p>Assuming you have an IME library readily available for converting symbols into characters (''IM Engine'' in our terminology), you would need to use the defined interface within the Gaia Keyboard app to receive symbols from the layout and output the characters. <a href="https://github.com/mozilla-b2g/gaia/blob/master/apps/keyboard/js/keyboard/input_method_manager.js">The current API is documented on Github</a>.</p>

<p>We invite implementations for further refining this API within Gaia.</p>

<h4 id="Make_your_IM_engine_work_with_your_layout">Make your IM engine work with your layout</h4>

<p>To get your IM Engine working with your keyboard layout:</p>

<ol>
 <li>Introduce a new layout for your IM Engine, as described below.</li>
 <li>Reference the IM engine with the <code>imEngine</code> property. When your layout is enabled, the keyboard app will start loading the script located at <code>keyboard/js/imes/&lt;imEngine&gt;/&lt;imEngine&gt;.js</code>.</li>
 <li>Set up the APIs to receive and send the keys/characters when the script is loaded and <code>init</code>'d.</li>
 <li>Do whatever you want in response to the user input. When the user taps a key on the keyboard, it will typically get sent to the IM Engine.</li>
</ol>

<h4 id="Known_implementations">Known implementations</h4>

<ul>
 <li><a href="https://github.com/timdream/jszhuyin">JSZhuyin</a> is the first implementation of a Gaia Keyboard Asian IM Engine for Traditional Chinese, incorporating Zhuyin IME.</li>
 <li><a href="https://github.com/mozilla-b2g/gaia/tree/master/apps/keyboard/js/imes/jskanji">JSKanji</a> is a prototype IM Engine written for Japanese.</li>
 <li><a href="https://github.com/mozilla-b2g/gaia/tree/master/apps/keyboard/js/imes/jspinyin">JSPinyin</a> is written for Simplified Chinese and works by tapping Pinyin symbols.</li>
 <li>As a demonstration, <a href="http://chewing.csie.net/">Chewing</a>, an C/C++ open-source Zhuyin IME for Traditional Chinese, was cross-compiled with <a href="/en-US/docs/Mozilla/Projects/Emscripten">Emscripten</a> and linked with the Gaia keyboard.</li>
 <li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=835261">JSHangul</a> is a prototype IM Engine for Korean, and is currently in development.</li>
</ul>

<h3 id="New_locales_from_the_localizers_perspective">New locales from the localizers perspective</h3>

<div class="note">
<p><strong>Note</strong>: This section applies mainly to alphabetic scripts; scripts using an abugida (like Amharic) or an ideographic system (like Chinese) are more complex.</p>
</div>

<p>Generally two things are required to add a new locale: a <strong>keyboard layout </strong>and a <strong>lexicon </strong>(for the predictive text feature).</p>

<h4 id="Creating_a_keyboard_layout">Creating a keyboard layout</h4>

<p>The keyboard layout is contained in a JavaScript file and defines which keys are on the keyboard and which of them result in which letters and symbols, including the secondary options available through long presses. The most straightforward way is to grab an existing keyboard from <a href="https://github.com/mozilla-b2g/gaia/tree/master/apps/keyboard/js/layouts">GitHub</a>, rename it and then adjust it.</p>

<p>First you need to change the header. Let's says your keyboard is close to en-US and the locale you want is Scottish Gaelic (gd). You would change this:</p>

<pre>Keyboards.en = {
 label: 'English',
 shortLabel: 'En',
 imEngine: 'latin',
 types: ['text', 'url', 'email', 'number', 'password'],
 autoCorrectLanguage: 'en_us',
 menuLabel: 'English',</pre>

<p>to this:</p>

<pre>Keyboards.gd = {
 label: 'Scottish Gaelic',
 shortLabel: 'gd',
 imEngine: 'latin',
 types: ['text', 'url', 'email', 'number', 'password'],
 autoCorrectLanguage: 'gd_gb',
 menuLabel: 'Gàidhlig',</pre>

<p>the <code>label </code>field should be the name of your language in English, the <code>shortLabel</code> field should be three characters long at the most; it's an abbreviation shown on the onscreen keyboard so the user knows which language they're currently using. You can use the ISO code but you can use something else too if appropriate. The <code>menuLabel</code> field is the name of your language written in your language: this is what the user sees in the menu options.</p>

<p>Now if the layout is close, the only thing you are likely to tweak are the alternative characters (which you access in the UI via a longpress):</p>

<pre>alt: {
  a: 'áàâäåãāæ',
  c: 'çćč',
  e: 'éèêëēę€ɛ',
  i: 'ïíìîīį',
  o: 'öõóòôōœøɵ',
  u: 'üúùûū',
  s: 'ßśš$',
  S: 'ŚŠ$',
  n: 'ñń',
  l: 'ł£',
  y: 'ÿ¥',
  z: 'žźż',
  '.': ',?!;:'
},</pre>

<p>You can change both the order and number of characters for the long press. In this case, because Gaelic uses the grave more often than the acute, we changed the order to:</p>

<pre>a: 'àáâäåãāæ',</pre>

<p>We also wanted to give people the option of using the dotted consonants, so we added new lines like this one:</p>

<pre><span class="nx">b</span><span class="o">:</span> <span class="s1">'ḃ'</span><span class="p">,</span></pre>

<p>You probably also want to check the alternative layout (for numbers, punctuation, etc.) and you probably also want to check that the right currency symbol is displayed.</p>

<h4 id="Creating_a_lexicon">Creating a lexicon</h4>

<p>It's better to have a lexicon too because otherwise users have to type out each word and don't get any word predictions. For this you need (ideally) some form of corpus to rank your words according to frequency. For example, the word <em>there</em> is a lot more common than <em>thespian </em>so when the user types the, <em>there</em> should be suggested before <em>thespian</em>.</p>

<p>This is done by assigning numbers from 1 (least frequent) to 255 (most frequent) to each word (aka line) in the lexicon (an XML file; you can have a look at the existing ones <a href="https://github.com/mozilla-b2g/gaia/tree/master/apps/keyboard/js/imes/latin/dictionaries">here</a>). This is what you need to create:</p>

<pre>&lt;wordlist locale="gd" description="Gàidhlig" date="1401554807" version="1"&gt;
 &lt;w f="255" flags=""&gt;a&lt;/w&gt;
 &lt;w f="254" flags=""&gt;an&lt;/w&gt;
 &lt;w f="247" flags=""&gt;agus&lt;/w&gt;</pre>

<p>Even a quick and dirty corpus (for example made by grabbing a large text and counting the frequencies) will help. If there is no such data at all for your locale and not much in the way of digital texts, use your knowledge of the language and give some manual rankings to the words you know from experience to be common.</p>

<h4 id="Building_the_files">Building the files</h4>

<p>Once you have the js and the lexicon file, go in <a href="https://github.com/mozilla-b2g/gaia/tree/master/apps/keyboard/js/imes/latin/dictionaries">this gaia directory</a> and open <em>Makefile</em>. Append the name of your dictionary to the list (e.g., if it's called <em>gd_wordlist.xml</em>), put:</p>

<pre>ga.dict \
gd.dict \</pre>

<p>Make sure the <code>gd_worldlist.xml</code> file is in the folder and run <code>$ make gd.dict</code></p>

<p>If you have gotten this far but get stuck at the last step of building the<em> .dict</em> file, <a href="https://bugzilla.mozilla.org/enter_bug.cgi?product=Firefox%20OS">file a bug</a> (<strong>Component: Gaia Keyboard</strong>) and attach your files and explain what the problem is. Someone should be able to help. <strong>Make sure to submit the patch as a pull request, and <em>flag for review to someone</em>, otherwise the bug will be likely unattended.</strong></p>

<h4 id="Testing_your_new_locale">Testing your new locale</h4>

<p>Once you have built and committed the files for the new locale, the quickest way of testing the new keyboard and lexicon is our <a href="https://github.com/timdream/gaia-keyboard-demo">web-based demo page</a> that runs the keyboard app. Click on En to cycle through the locales. If you can't see yours, click the spanner symbol (top right) and tick/untick the keyboards you want to test.</p>

<h2 id="Discussion_and_QA">Discussion and QA</h2>

<p>Please come to the <a href="https://lists.mozilla.org/listinfo/dev-gaia">dev-gaia</a> mailing list or the #gaia channel on irc.mozilla.org (see <a href="https://wiki.mozilla.org/IRC">Mozilla IRC</a> for more details). #mozilla-taiwan is the de-facto Chinese-language channel for this topic.</p>