<p></p><section class="Quick_links" id="Quick_Links">

<ol>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_build_process_summary">B2G OS build process summary</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/B2G_OS_build_prerequisites">Build prerequisites</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Preparing_for_your_first_B2G_build">Preparing for your first build</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building">Building B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_installer_add-on">B2G installer add-on</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Building_for_Flame_on_OS_X">Building B2G OS for Flame on Mac OS X</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Choosing_how_to_run_Gaia_or_B2G">Choosing how to run Gaia or B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Compatible_Devices">Compatible Devices</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Installing_on_a_mobile_device">Installing B2G OS on a mobile device</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_update_packages">Creating and applying B2G OS update packages</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building/FOTA_community_builds">Building and installing FOTA community builds</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_Build_Variables_Reference_Sheet">B2G build variables reference sheet</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting B2G OS</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/basics">Porting basics</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/Porting_on_CyanogenMod">Porting on CyanogenMod</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Running_the_Gaia_codebase">Running the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Mulet">Run Gaia on desktop using Mulet</a></li>

   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Understanding_the_Gaia_codebase">Understanding the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Making_Gaia_code_changes">Making Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Testing_Gaia_code_changes">Testing Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Submitting_a_Gaia_patch">Submitting a Gaia patch</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Build_System_Primer">Gaia build system primer</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Different_ways_to_run_Gaia">Different ways to run Gaia</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/make_options_reference">Make options reference</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Gaia_tools_reference">Gaia tools reference</a></li>
  </ol>
 </li>
 <li><a href="/en-US/docs/Mozilla/B2G_OS/API">B2G OS APIs</a></li>
</ol>
</section><p></p>

<p class="summary">Add-ons are a well-known concept in the world of web browsers, and this concept has been added to Firefox OS too. A single Firefox OS add-on can extend just one app, several, or all of them, including the system app itself. This article provides a guide to creating your own Firefox OS add-ons, as well as hints, tips, and other information to be aware of.</p>

<div class="note">
<p><strong>Note</strong>: Firefox OS Add-ons use the WebExtensions extension model, which is largely based on Chrome/Blink add-ons, providing many advantages to how add-ons are created, in terms of interoperability and features. To learn more, keep checking back on our growing <a href="/en-US/Add-ons/WebExtensions">WebExtensions documentation</a>.</p>
</div>

<div class="warning">
<p><strong>Important</strong>: Add-ons are only available on Firefox OS 2.5+, and you'll also need a new build installed on your phone to make sure you have the updated WebIDE support for debugging extensions, etc. Make sure you upgrade to the latest available build (2015-08-27 or later) on your developer phone before you start developing Firefox OS add-ons.</p>
</div>

<h2 id="Developing_add-ons">Developing add-ons</h2>

<p>Add-ons are app packages composed of JavaScript, CSS, and other assets. However, they don't run as standalone apps. Instead, the add-on manifest includes special features to define what apps to apply the add-on to. When apps are launched on a Firefox OS device that has an add-on installed, the add-on is injected into any app that matches the pattern specifed in the matches field of the <a href="#manifest.json">manifest.json</a> file.</p>

<p>Firefox OS add-ons use the same syntax and structure for their code as the new school of Firefox add-ons developed using the <a href="https://wiki.mozilla.org/WebExtensions">WebExtensions API</a>, which is itself based on the <a href="https://developer.chrome.com/extensions">Chrome extensions</a> model.</p>

<h3 id="A_simple_example">A simple example</h3>

<p>To help explain Firefox OS add-on basics, we'll introduce a simple example that adds a banner to the system app, which can be clicked to dismiss it.</p>

<p><img alt="firefox os screenshot showing add-on banner" src="https://mdn.mozillademos.org/files/11445/add-on-screenshot.png" style="display: block; height: 445px; margin: 0px auto; width: 250px;"></p>

<p>This is very basic and trivial, but it gives you enough to get started. You can check out the <a href="https://github.com/mdn/simple-addon">example code on Github</a>, and install the add-on on your Firefox OS device by cloning the repo locally and using WebIDE (see the <a href="#Testing_your_add-on_using_WebIDE">Testing your add-on using WebIDE</a> section.) You can <a href="/en-US/docs/Mozilla/Marketplace/Add-on_submission">distribute add-ons using the Firefox Marketplace</a>.</p>

<p>Be aware that Firefox OS add-ons can do a lot more than what we've got listed here. The <a href="/en-US/docs/Mozilla/Add-ons/WebExtensions">WebExtensions</a> documentation will have more information added as time goes on.</p>

<h2 id="The_anatomy_of_a_Firefox_OS_add-on">The anatomy of a Firefox OS add-on</h2>

<p>In this section we'll walk through the contents of the sample add-on repo, explaining each piece of content. The directory structure looks like this:</p>

<ul class="directory-tree">
 <li>simple-addon/
  <ul>
   <li>manifest.json</li>
   <li>update.webapp</li>
   <li>css/
    <ul>
     <li>style.css</li>
    </ul>
   </li>
   <li>js/
    <ul>
     <li>index.js</li>
    </ul>
   </li>
   <li>icons/
    <ul>
     <li>128.png</li>
    </ul>
   </li>
   <li>extension.zip</li>
  </ul>
 </li>
</ul>

<h3 id="manifest.json">manifest.json</h3>

<p>You'll notice that we've got two manifest-type files inside our sample add-on directory. The first of these — <code>manifest.json</code> — follows the Chrome-style manifest structure, and is placed inside the <a href="#extensions.zip">extensions.zip</a> package along with the CSS, JavaScript and icon assets that comprise the add-on. It can contain a large variety of instructions (see <a href="https://developer.chrome.com/extensions/manifest">Chrome Manifest File Format</a>), but for now we're just going to concentrate on a simple subset:</p>

<pre class="brush: json">{
  "manifest_version": 1,
  "name": "Add-on banner",
  "description": "Firefox OS add-on example",
  "version": "1.0",
  "author": "Chris Mills",
  "content_scripts": [{
    "matches": ["app://system.gaiamobile.org/index.html"],
    "css": ["css/style.css"],
    "js": ["js/index.js"]
  }],
  "icons": {
    "128": "/icons/128.png"
  }
}</pre>

<p>Most of these fields are pretty self-explanatory, but we'll cover the last few.</p>

<p>First of all, the <code>content_scripts</code> field references the code that will be injected into apps that the add-on is applied to — you'll see that we are providing the path to the CSS and JavaScript files in the <code>css</code> and <code>js</code> fields. The <code>matches</code> field contains a pattern that specifies which apps the code will be injected into. This pattern can take a number of different forms (see <a href="https://developer.chrome.com/extensions/match_patterns">Chrome Match Patterns</a>), but for now we are simply specifying <code>app://system.gaiamobile.org/index.html</code>, which causes it to affect the system app only. You could apply it to all app using <code>app://*/* </code>.</p>

<div class="note">
<p><strong>Note</strong>: You can reference multiple scripts and stylesheets by simply including multiple items in the arrays, for example <code>"css": ["css/style.css", "css/more.css"]</code>.</p>
</div>

<div class="note">
<p><strong>Note</strong>: Firefox OS does not currently support the Chrome &lt;all_urls&gt; keyword.</p>
</div>

<p>At the bottom of the manifest we've included the <code>icons</code> field; see the next section for more info on this.</p>

<h3 id="update.webapp">update.webapp</h3>

<div class="note">
<p><strong>Note</strong>: You don't need the <code>.webapp</code> manifest if you are <a href="/en-US/docs/Mozilla/Marketplace/Add-on_submission">submitting add-ons to the Firefox Marketplace</a> — you just need the <code>.zip</code> file.</p>
</div>

<p>The <code>update.webapp</code> manifest is a <a href="https://developer.mozilla.org/en-US/Apps/Build/Manifest">Firefox OS-style Manifest</a>, which is basically a packaged app-style mini-manifest (see <a href="https://developer.mozilla.org/en-US/Marketplace/Options/Self_publishing#Self-publishing_packaged_apps">Self-publishing packaged apps</a>.)</p>

<p>Our <code>update.webapp</code> file looks like so:</p>

<pre class="brush: json">{
  "name" : "Add-on banner",
  "description": "Firefox OS add-on example",
  "developer": { "name": "Chris Mills" },
  "package_path": "extension.zip",
  "icons": {
    "128": "/icons/128.png"
  }
}</pre>

<p>Again, most of this is fairly self-explanatory.</p>

<p>Probably the most important field in here is <code>package_path</code>, which points to the package that contains the extension.</p>

<p>You'll notice that the <code>icons</code> field is included here, the same as it is in <a href="#manifest.json">manifest.json</a> — <code>update.webapp</code> is the only place you <em>need</em> to have the icons information at the moment, but we'd recommend you include it in both places for now, just in case things change. The <code>icons</code> field points to the add-on icon so it can be used inside the Gaia Settings app.</p>

<h3 id="Including_an_icon">Including an icon</h3>

<p>You need to include at least one icon and reference it from your manifest, otherwise the manifest doesn't validate. See <a href="https://developer.mozilla.org/en-US/Apps/Build/Manifest#icons">the Manifest reference icons section</a> for more information.</p>

<h3 id="CSS">CSS</h3>

<div class="warning">
<p><strong>Important</strong>: Due to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1179536">bug 1179536</a>, injecting style sheets into anything but the system app is broken. It will still work for this tutorial since this add-on only effects the system app, but for adding styles to any other app or webpage you will need to modify the styling using JavaScript.</p>
</div>

<p>There is nothing special about the CSS included in the example. The only thing to bear in mind is that you should make sure your add-on classnames and selectors do not conflict with any of the existing CSS in the app(s) it is applied to.</p>

<p>For example, we wrapped our example banner in a <a href="/en-US/docs/Web/HTML/Element/div" title="The HTML &lt;div> element is the generic container for flow content and does not inherently represent anything. Use it to group elements for purposes such as styling (using the class or id attributes), marking a section of a document in a different language (using the lang attribute), and so on."><code>&lt;div&gt;</code></a> with class <code>fxos-banner</code>. But you could even consider using some kind of unique code for your classname.</p>

<h3 id="JavaScript">JavaScript</h3>

<p>Again, the JavaScript file that powers the add-on doesn't have any special functionality inside it (see the <a href="https://github.com/mdn/simple-addon/blob/gh-pages/js/index.js">JavaScript source on Github</a>.) It is injected into the apps it is applied to along with any CSS specified in the <a href="#manifest.json">manifest.json</a> file.</p>

<div class="note">
<p><strong>Note</strong>: Add-on code is injected every time an app is launched and the match specified in manifest.json pattern matches that app. It is also injected whenever add-ons are enabled. When an add-on is injected into an app because the app is launching, all add-on files are injected into the app before anything in the app is initialized, including the DOM. It is up to the add-on developer to handle the different launch cases cases (immediate injection vs. injection on launch); there is more info on this below.</p>
</div>

<p>Other main things to note are covered below.</p>

<h4 id="The_window_object">The window object</h4>

<p>Add-ons only share a proxied version of the content <code>window</code>. As a result, anything that is written to the <a href="/en-US/docs/Web/API/Window">window</a> object from an add-on is unavailable to the app code. However, anything on the <code>window</code> object that is set by app code is available to add-ons. Similarly, the DOM is accessible as usual.</p>

<h4 id="DOM_injection">DOM injection</h4>

<p>You can use JavaScript APIs to manipulate the app's DOM.</p>

<h4 id="Injecting_code_at_the_correct_time">Injecting code at the correct time</h4>

<p>You must be careful to properly handle cases where an add-on is injected into an app after the app has been loaded. Such a scenario can occur when an app is already running and an add-on that targets it is enabled. in such a case, a <a href="/en-US/docs/Web/API/GlobalEventHandlers/onload">window.onload</a> handler won't work because the <a href="/en-US/docs/Web/Events/DOMContentLoaded">DOMContentLoaded</a> event has already occured.</p>

<p>There's no good solution to this problem right now. In the interim, we recommend to check whether or not the DOM has been loaded before setting a <code>DOMContentLoaded</code> callback. This pattern is used in the demo:</p>

<pre class="brush: js">// If injecting into an app that was already running at the time
// the app was enabled, simply initialize it.
if (document.documentElement) {
  initialize();
}

// Otherwise, we need to wait for the DOM to be ready before
// starting initialization since add-ons are usually (always?)
// injected *before* `document.documentElement` is defined.
else {
  window.addEventListener('DOMContentLoaded', initialize);
}

function initialize() {
  // ...
}
</pre>

<h4 id="Preventing_multiple_injections">Preventing multiple injections</h4>

<p>Finally, to prevent an add-on from being injected into a single app instance multiple times, you should check whether your add-on is already present, like this:</p>

<pre class="brush: js">function initialize() {
  if (document.querySelector('.fxos-banner')) {
    // Already injected, abort.
    return;
  } else {
    var body = document.querySelector('body');
    var fxosBanner = document.createElement('div');
    fxosBanner.classList.add('fxos-banner');
    var bannerText = document.createElement('p');
    var closeBtn = document.createElement('button');

    fxosBanner.appendChild(bannerText);
    fxosBanner.appendChild(closeBtn);
    body.appendChild(fxosBanner);

    closeBtn.textContent = 'X';
    bannerText.textContent = 'Wow, you have an extension installed!';

    closeBtn.onclick = function() {
      fxosBanner.parentNode.removeChild(fxosBanner);
    }
  }
}
</pre>

<p>So here we are using <code>if (document.querySelector('.fxos-banner'))</code> to check whether the example banner already exists. If so, then we return out of the function. If not, then the <code>querySelector()</code> method returns <code>null</code>, and we run the code block that creates the banner.</p>

<h4 id="App_management_functions_in_add-ons">App management functions in add-ons</h4>

<p>All <code><a href="/en-US/docs/Web/API/DOMApplicationsRegistry">Apps</a></code> and <code><a href="/en-US/docs/Web/API/DOMApplicationsRegistry/mgmt">Mgmt</a></code> functions work on add-ons just like they do on apps. Be aware however that the latter are only available to add-ons when they are injected into a certified app that has the <code>webapps-manager</code> permission specified in the manifest.</p>

<p>In addition to these functions, an <code><a href="http://mxr.mozilla.org/mozilla-central/source/dom/webidl/Apps.webidl#141">onenabledstatechange</a></code> callback is exposed for add-ons being enabled and disabled. This event is fired for all add-ons, so you will have to check which add-on was enabled/disabled before performing initialization or cleanup.</p>

<pre class="brush: js"><span>navigator.mozApps.mgmt</span>.<span>addEventListener('enabledstatechange</span>', <span>function</span>(<span>event</span>) {
  var app = event.application;
  if (app.manifestURL === 'https://origin.of.manifest/manifest.webapp') {
    var wasEnabled = app.enabled;
    // do something with this information
  }
});
</pre>

<div class="warning">
<p><strong>Important</strong>:  Due to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1214155">bug 1214155</a> you cannot add the enabled state listener via <code>navigator.mozApps.mgmt.</code><span id="summary_alias_container"><span id="short_desc_nonedit_display"><code>onenabledstatechange = function() {...}</code>: you must use the <code>addEventListener</code> method as mentioned above.</span></span></p>
</div>

<h3 id="extension.zip">extension.zip</h3>

<div class="note">
<p><strong>Note</strong>: The <code>extension.zip</code> file has been left in the demo repo mainly for illustrative purposes, so it is clear how the system works. You actually don't need to include the zip in your directory, as WebIDE will generate it for you when you install the add-on.</p>
</div>

<p>The <code>extension.zip</code> archive contains the code for the extension, and is referenced in the <a href="#update.webapp">update.webapp</a> <code>package_path</code> field — This is how Gecko finds the code to be installed. Archived inside you'll find:</p>

<ul class="directory-tree">
 <li>css/
  <ul>
   <li>style.css</li>
  </ul>
 </li>
 <li>js/
  <ul>
   <li>index.js</li>
  </ul>
 </li>
 <li>icons/
  <ul>
   <li>128.png</li>
  </ul>
 </li>
 <li>manifest.json</li>
</ul>

<p>So the <code>manifest.json</code> file sits inside the archive, and serves to reference the files to be injected and specify which apps to affect.</p>

<h3 id="Testing_your_add-on_using_WebIDE">Testing your add-on using WebIDE</h3>

<p>Mozilla's WebIDE tool is available in Firefox desktop by default. To use it for installing add-ons on your phone, follow the steps listed below:</p>

<ol>
 <li>Make sure you have Firefox 43 or above installed (this was <a href="https://nightly.mozilla.org/">Nightly</a> at the time of writing), as add-ons are not supported in WebIDE below this version.</li>
 <li>Open your browser and open the WebIDE tool (press the WebIDE button, or choose <em>Tools &gt; Web Developer &gt; WebIDE</em> from the menu.)</li>
 <li>Make sure your phone has remote debugging enabled (<em>Settings App &gt; Developer &gt; Set the "Debugging via USB " selection to "ADB and DevTools".</em>)</li>
 <li>Connect your phone to your computer via a USB cable. Make sure you don't have other phones connected at the same time.</li>
 <li>In the WebIDE UI, press the <em>Select Runtime</em> option, and select your phone, which should be listed under <em>USB Devices</em>.</li>
 <li>At this point, your phone should be showing an <em>Allow USB debugging connection?</em> prompt. Choose <em>Allow</em>.</li>
 <li>Select the <em>Open App</em> option, then choose <em>Open Packaged App...</em></li>
 <li>In the resulting file chooser, navigate to the directory that contains your <code>update.webapp</code> manifest file, and press <em>Open</em>.</li>
 <li>Providing there are no warnings or errors reported, you can install your add-on on the device using the "Play" button in the center (<em>Install and Run</em>.)</li>
 <li>To see the add-on in action, enable it by choosing <em>Settings app &gt; Add-ons &gt; Add-on example &gt; toggle the checkbox at the top</em>.</li>
</ol>

<h2 id="Debugging_add-ons">Debugging add-ons</h2>

<p>Please note due to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1185464" title="The new extension API should come with debuggability">bug 1185464</a> it is not currently possible to debug add-ons with WebIDE.</p>

<h2 id="Add-on_settings">Add-on settings</h2>

<p>You can control the add-ons on your phone by going to <em>Settings app &gt; Add-ons</em>; in here you'll find a list of your installed add-ons, and you can tap each entry to see more information about each add-on.</p>

<p style="width: 520px; margin: 0 auto;"><img alt="firefox os screenshot showing a list of installed add-ons in the settings app" src="https://mdn.mozillademos.org/files/11447/add-on-settings-screen.png" style="height: 445px; margin-right: 20px; width: 250px;"><img alt="information screen for an individual addon, with a list of apps this add-on affects, and controls to disable and delete the add-on" src="https://mdn.mozillademos.org/files/11449/individual-add-on-settings-page.png" style="height: 445px; width: 250px;"></p>

<h3 id="Enablingdisabling_and_deleting_add-ons">Enabling/disabling and deleting add-ons</h3>

<p>By default, add-ons will be enabled after installation when they are installed from the Firefox Marketplace. When installed via WebIDE however they will be disabled by default.</p>

<p>You can manually enable/disable add-ons via the checkbox at the top of each individual add-on's page (found under <em>Settings app &gt; Add-ons</em>), or programmatically using the <a href="/en-US/docs/Web/API/DOMApplicationsManager/setEnabled">navigator.mozApps.mgmt.setEnabled()</a> function (see this <a href="https://github.com/fxos/directory/blob/master/app/js/controller/list_controller.js#L220-L223">setEnabled() usage example</a> on Github.)</p>

<p>You can delete an add-on entirely by tapping the <em>Delete</em> button found on individual app pages.</p>

<h2 id="Permissions">Permissions</h2>

<p>Add-ons inherit their permissions entirely from their host app. Requesting permissions in the add-on manifest (see <a href="#update.webapp">update.webapp</a>) will have no effect, and will not expose any APIs to the add-on that are not available to the host app.</p>