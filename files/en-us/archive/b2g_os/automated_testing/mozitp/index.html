---
title: The Mozilla integrated tools package
slug: Archive/B2G_OS/Automated_testing/MozITP
tags:
  - B2G
  - Firefox OS
  - Flash
  - Marionette
  - MozITP
  - Testing
  - Tools
  - taskcluster
---
<p></p><section class="Quick_links" id="Quick_Links">

<ol>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_build_process_summary">B2G OS build process summary</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/B2G_OS_build_prerequisites">Build prerequisites</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Preparing_for_your_first_B2G_build">Preparing for your first build</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building">Building B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_installer_add-on">B2G installer add-on</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Building_for_Flame_on_OS_X">Building B2G OS for Flame on Mac OS X</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Choosing_how_to_run_Gaia_or_B2G">Choosing how to run Gaia or B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Compatible_Devices">Compatible Devices</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Installing_on_a_mobile_device">Installing B2G OS on a mobile device</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_update_packages">Creating and applying B2G OS update packages</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building/FOTA_community_builds">Building and installing FOTA community builds</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_Build_Variables_Reference_Sheet">B2G build variables reference sheet</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting B2G OS</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/basics">Porting basics</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/Porting_on_CyanogenMod">Porting on CyanogenMod</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Running_the_Gaia_codebase">Running the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Mulet">Run Gaia on desktop using Mulet</a></li>

   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Understanding_the_Gaia_codebase">Understanding the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Making_Gaia_code_changes">Making Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Testing_Gaia_code_changes">Testing Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Submitting_a_Gaia_patch">Submitting a Gaia patch</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Build_System_Primer">Gaia build system primer</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Different_ways_to_run_Gaia">Different ways to run Gaia</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/make_options_reference">Make options reference</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Gaia_tools_reference">Gaia tools reference</a></li>
  </ol>
 </li>
 <li><a href="/en-US/docs/Mozilla/B2G_OS/API">B2G OS APIs</a></li>
</ol>
</section><p></p><p class="summary">The Mozilla integrated tools package (MozITP) is a one-stop shop for setting up Firefox OS-related tools, which can handle automatic Testing on Mulet or a real device, <a href="https://pypi.python.org/pypi/b2g_util">flashing TaskCluster images</a>, flashing with the <a href="/en-US/docs/Mozilla/Firefox_OS/Building_and_installing_Firefox_OS/B2G_installer_add-on">B2G installer add-on</a>, and running the TV and phone versions of Mulet. This article details how the toools package works, and how it can be installed.</p>

<h2 id="Environment_setup">Environment setup</h2>

<p>MozITP depends on Vagrant and Virtualbox. By default, VMs in VirtualBox will automartically enable <code>VT-x/AMD-V</code> and <code>Nested Paging</code>, so you should enable the <code>VT-x/AMD-V</code> feature of your host.</p>

<p>Let&apos;s look at how to set up the environment on Linux, Mac OS X, and Windows.</p>

<h3 id="Ubuntu">Ubuntu</h3>

<ul>
 <li>Download <a href="https://www.vagrantup.com/downloads.html">Vagrant&apos;s Debian package</a>.</li>
 <li>Install Vagrant using this:
  <pre class="brush: bash"><code>$ sudo dpkg -i &lt;PATH_TO_PKG_FILE&gt;</code></pre>
 </li>
 <li>Install VirtualBox using this:
  <pre class="brush: bash"><code>$ sudo apt-get install virtualbox virtualbox-dkms virtualbox-qt</code></pre>
 </li>
 <li>Reboot your computer after the Virtualbox installation has finished.</li>
 <li>Download and install the <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox Extension Pack</a>.</li>
 <li><a href="https://help.ubuntu.com/community/VirtualBox/USB">Set up the USB for VirtualBox</a> using the following command:
  <pre class="brush: bash"><code>$ sudo adduser &lt;USERNAME&gt; vboxusers</code></pre>
 </li>
 <li>Re-login or restart your computer.</li>
 <li>Make sure you enable Intel VT-x and VT-d in the BIOS.</li>
</ul>

<h3 id="Mac_OS_X">Mac OS X</h3>

<ul>
 <li>Install <a href="http://caskroom.io/">Brew Cask</a>.</li>
 <li>Install Vagrant using this:
  <pre class="brush: bash"><code>$ sudo brew cask install vagrant; sudo brew cask install vagrant-manager</code></pre>
 </li>
 <li>Install VirtualBox using this:
  <pre class="brush: bash"><code>$ sudo brew cask install virtualbox</code></pre>
 </li>
 <li>Install the VirtualBox Extension Pack using the following:
  <pre class="brush: bash"><code>$ sudo brew cask install virtualbox-extension-pack</code></pre>
 </li>
 <li>Make sure you enable Intel VT-x and VT-d in BIOS.</li>
</ul>

<h3 id="Windows_(experimental)">Windows (experimental)</h3>

<ul>
 <li>Install the <a href="http://www.git-scm.com/download/win">Windows version of Git</a>. Make sure that you don&apos;t let Git change the line ending symbol to windows format.</li>
 <li>Install the <a href="http://win-bash.sourceforge.net/">Windows bash shell</a>.</li>
 <li>Install <a href="https://www.vagrantup.com/downloads.html">Vagrant for Windows</a>.</li>
 <li>Install <a href="https://www.virtualbox.org/wiki/Downloads">Virtualbox for Windows</a>.</li>
 <li>Run <code>launch.sh</code> in PowerShell or git-bash.</li>
 <li>Make sure you enable Intel VT-x and VT-d in your computer&apos;s BIOS.</li>
 <li>If your VirtualBox VM failed to start, try enabling <em>Hyper-V</em> in <em>VirtualBox &gt; Settings &gt; System &gt; Accleration &gt; Paravirtualization Interface</em>.</li>
</ul>

<h3 id="Other_Platforms">Other Platforms</h3>

<p>Whatever the case, you need to install <a href="https://docs.vagrantup.com/v2/installation/index.html">Vagrant</a> — see the <a href="https://www.vagrantup.com/docs/installation/index.html">Installing Vagrant</a> guide for more details.</p>

<p>You also need to install a VM <a href="https://docs.vagrantup.com/v2/providers/index.html">provider</a> for Vagrant. We are assuming the use of <a href="http://www.virtualbox.org/">VirtualBox</a> throughout our article.</p>

<h2 id="Cloning_the_Repo">Cloning the Repo</h2>

<p>After the environment has been set up, you need to clone the MozITP repo. Do so with the following command:</p>

<pre class="brush: bash"><code>$ git clone </code>https://github.com/mozilla-b2g/MozITP.git</pre>

<p>You can run <code>git pull</code> at any time to get the latest version of the repo.</p>

<h2 id="Usage">Usage</h2>

<p>Now you&apos;ve set up the environment and cloned the repo, you can start using MozITP.</p>

<div class="note">
<p><strong>Note</strong>: The following commands should be run from inside the <code>MozITP</code> directory.</p>
</div>

<h3 id="Setting_permissions">Setting permissions</h3>

<p>If you get any problems running the scripts, you need to make sure you have the necessary permissions set on the commands. Add execute permissions, for example:</p>

<pre class="brush: bash"><code class="sourceCode bash">$ <span class="kw">chmod</span> u+x launch.sh</code></pre>

<h3 id="Launching_the_MozITP">Launching the MozITP</h3>

<p>Launch MozITP with the following command:</p>

<pre class="brush: bash"><code class="sourceCode bash">$ <span class="kw">./launch.sh</span></code></pre>

<p>At this point a Vagrant VM will be launched — you should see something like this:</p>

<div class="figure"><img src="https://raw.githubusercontent.com/Mozilla-TWQA/MozITP/master/menu.png" alt="menu"></div>

<h3 id="Stopping_MozITP">Stopping MozITP</h3>

<p>To stop the VM, running the following:</p>

<pre class="brush: bash"><code class="sourceCode bash">$ <span class="kw">./bin/stop.sh</span></code></pre>

<h3 id="Resetting_to_factory">Resetting to factory</h3>

<p>To reset the VM to the factory defaults, run this command:</p>

<pre class="brush: bash"><code class="sourceCode bash">$ <span class="kw">./bin/reset_vm.sh</span></code></pre>

<h3 id="Updating_the_VM">Updating the VM</h3>

<p>To update to the latest version of the VM, run the following:</p>

<pre class="brush: bash"><code>$ ./bin/update_vm.sh</code></pre>

<h2 id="GIJ_(Gaia_Integration_Test_JS_Marionette)">GIJ (Gaia Integration Test / JS Marionette)</h2>

<p>You can run the GIJ (Gaia integration tests in JavaScript) directly from inside MozITP, which is very useful for automation. See the <a href="#Supported_Platforms">Supported Platforms</a> section for available targets.</p>

<div class="warning notecard">
<p><strong>Warning</strong>: Sometimes the test case itself has bugs, which makes the GIJ test fail. To verify if it&apos;s a GIJ platform bug or a test case bug, try running the <code>./test/gij_phone_mulet_sanity_test.sh</code> or <code>./test/gij_phone_device_sanity_test.sh</code> files, depending on whether you are running the tests on Mulet or a real device. If it passes, it could be a bug in the test case, not the platform.</p>
</div>

<h3 id="Running_GIJ">Running GIJ</h3>

<p>To run GIJ directly, run the following:</p>

<pre class="brush: bash"><code class="sourceCode bash">$ <span class="kw">./launch.sh</span> gij</code></pre>

<p>To run GIJ just on a specific app, you&apos;ll need a command structure like the following:</p>

<pre class="brush: bash"><code class="sourceCode bash">$ <span class="kw">export</span> <span class="ot">APP=</span>video; <span class="kw">./launch.sh</span> gij <span class="co"># The `export` is important, don&apos;t miss it</span></code></pre>

<p>To run GIJ on a specific test file:</p>

<pre class="brush: bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">TEST_FILES=</span>apps/clock/test/marionette/hour_format_test.js
<span class="kw">./launch.sh</span> gij</code></pre>

<h3 id="Running_GIJ_directly_on_a_device">Running GIJ directly on a device</h3>

<p>To run GIJ directly on the device. The device must be connected through USB before you run the command</p>

<pre class="brush: bash"><code class="sourceCode bash">$ <span class="kw">./launch.sh</span> gij device</code></pre>

<h3 id="Running_GIJ_with_your_own_Gaia_build">Running GIJ with your own Gaia build</h3>

<p>If you already have a Gaia repository you want to test, you can use the following commands:</p>

<pre class="brush: bash"><code class="sourceCode bash"><span class="kw">export</span> <span class="ot">GAIA=</span>/path/to/your/gaia
<span class="kw">./launch.sh</span></code></pre>

<p>If you change your mind and want to use the latest Gaia instead, you can do this:</p>

<pre class="brush: bash"><code>./reset_vm.sh
unset GAIA
./launch.sh</code></pre>

<p>Or if you want to keep the VM, you can do this:</p>

<pre class="brush: bash"><code>unset GAIA
./launch.sh

# Remove the flag
vagrant ssh -c &quot;rm ~/.users_gaia_exists&quot;

# Restart the VM
./bin/stop.sh
./launch.sh</code></pre>

<h2 id="GIP_(Python_Gaia_Integration_Test)">GIP (Python Gaia Integration Test)</h2>

<p>See the <a href="#Supported_Platforms">Supported Platforms</a> section for available targets.</p>

<h3 id="Running_GIP">Running GIP</h3>

<p>To run GIP, do the following:</p>

<pre class="brush: bash"><code>./launch.sh gip </code></pre>

<h2 id="Flashing">Flashing</h2>

<p>Let&apos;s look at how to flash a TaskCluster image onto your instance of MozITP.</p>

<p>If you already have TaskCluster credentials:</p>

<ul>
 <li>For flashing the TaskCluster image (needs credentials), please run <code>./bin/get_credentials.sh</code> before flashing. </li>
 <li>Next, run <code>launch.sh</code> and select <code>Flashing B2G Image.</code></li>
 <li>Or just run <code>./launch.sh flash</code>.</li>
</ul>

<p>If you don&apos;t have TaskCluster credentials:</p>

<ul>
 <li>You can use the <a href="/en-US/docs/Mozilla/Firefox_OS/Building_and_installing_Firefox_OS/B2G_installer_add-on">B2G installer add-on</a> to handle this.</li>
 <li>Run <code>./launch.sh</code> and select <code>Enter Firefox b2g-installer Add-on</code> from the menu.</li>
</ul>

<h2 id="Shared_Folder">Shared Folder</h2>

<p>You can put files/folders into the <strong>shared</strong> folder.</p>

<ul>
 <li>The <strong>shared</strong> folder will be pushed from the host to the VM when you run <code>./launch.sh</code>.</li>
 <li>The <strong>shared</strong> folder will be pulled from the VM to the host when you exit the <code>launch.sh</code> script, or when running <code>./bin/stop.sh</code>.</li>
</ul>

<p>The following table contains a summary of the commands:</p>

<table>
 <thead>
  <tr>
   <th>Command</th>
   <th>From</th>
   <th>To</th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td>run <code>./launch.sh</code></td>
   <td>host</td>
   <td>VM</td>
  </tr>
  <tr>
   <td>exit <code>./launch.sh</code></td>
   <td>VM</td>
   <td>host</td>
  </tr>
  <tr>
   <td>run <code>./bin/stop.sh</code></td>
   <td>VM</td>
   <td>host</td>
  </tr>
 </tbody>
</table>

<h2 id="Troubleshooting">Troubleshooting</h2>

<ul>
 <li>To run <code>launch.sh</code> in Jenkins or over SSH, use <code>xvfb-run ./launch.sh</code>, otherwise the <code>vagrant up</code> command will fail.</li>
 <li>To run tests on a device connected via USB device, you need to first add the user to the <code>vboxusers</code> group using the following command structure:
  <pre class="brush: bash"><code>$ sudo adduser &lt;your username&gt; vboxusers</code></pre>
 </li>
 <li>If you want to run tests against USB-connected devices in Jenkins, also add the <code>jenkins</code> user to the <code>vboxusers</code> group.</li>
</ul>

<h2 id="Supported_Platforms">Supported Platforms</h2>

<p>The following platforms are supported by MozITP:</p>

<ul>
 <li>Linux</li>
 <li>OS X</li>
 <li>Windows (experimental)</li>
 <li>Flashable devices: Aries (Sony Z3C), Flame</li>
</ul>

<p>The following table shows the different environments that can be tested/emulated by MozITP, and how well specific tests currently work on those environments:</p>

<table>
 <thead>
  <tr class="header">
   <th>Platform</th>
   <th>GIJ</th>
   <th>GIP</th>
   <th>Fuzz</th>
  </tr>
 </thead>
 <tbody>
  <tr class="odd">
   <td>Phone Mulet</td>
   <td>OK (headless)</td>
   <td>OK</td>
   <td>2015 Q1</td>
  </tr>
  <tr class="even">
   <td>Phone Device</td>
   <td>OK</td>
   <td>OK</td>
   <td>OK</td>
  </tr>
  <tr class="odd">
   <td>Phone Emulator</td>
   <td>Too slow</td>
   <td>by request*</td>
   <td>by request*</td>
  </tr>
  <tr class="even">
   <td>TV Mulet</td>
   <td>2015 Q1</td>
   <td>by request*</td>
   <td>by request*</td>
  </tr>
  <tr class="odd">
   <td>TV Device</td>
   <td>by request*</td>
   <td>by request*</td>
   <td>by request*</td>
  </tr>
  <tr class="even">
   <td>TV Emulator</td>
   <td>by request*</td>
   <td>by request*</td>
   <td>by request*</td>
  </tr>
 </tbody>
</table>

<p>* This combination doesn&apos;t currently work. If you need it/want to help with getting it running, please <a href="https://bugzilla.mozilla.org/">file a bug</a> or email us on the <a href="https://lists.mozilla.org/listinfo/dev-fxos">dev-fxos mailing list</a>.</p>

<h2 id="See_Also">See Also</h2>

<p><a href="https://github.com/mozilla-b2g/MozITP">The MozITP main repository</a></p>
