<div><section class="Quick_links" id="Quick_Links">

<ol>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_build_process_summary">B2G OS build process summary</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/B2G_OS_build_prerequisites">Build prerequisites</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Preparing_for_your_first_B2G_build">Preparing for your first build</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building">Building B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_installer_add-on">B2G installer add-on</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Building_for_Flame_on_OS_X">Building B2G OS for Flame on Mac OS X</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Choosing_how_to_run_Gaia_or_B2G">Choosing how to run Gaia or B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Compatible_Devices">Compatible Devices</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Installing_on_a_mobile_device">Installing B2G OS on a mobile device</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_update_packages">Creating and applying B2G OS update packages</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building/FOTA_community_builds">Building and installing FOTA community builds</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_Build_Variables_Reference_Sheet">B2G build variables reference sheet</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting B2G OS</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/basics">Porting basics</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/Porting_on_CyanogenMod">Porting on CyanogenMod</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Running_the_Gaia_codebase">Running the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Mulet">Run Gaia on desktop using Mulet</a></li>

   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Understanding_the_Gaia_codebase">Understanding the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Making_Gaia_code_changes">Making Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Testing_Gaia_code_changes">Testing Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Submitting_a_Gaia_patch">Submitting a Gaia patch</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Build_System_Primer">Gaia build system primer</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Different_ways_to_run_Gaia">Different ways to run Gaia</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/make_options_reference">Make options reference</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Gaia_tools_reference">Gaia tools reference</a></li>
  </ol>
 </li>
 <li><a href="/en-US/docs/Mozilla/B2G_OS/API">B2G OS APIs</a></li>
</ol>
</section></div>

<div class="summary">
<p><span class="seoSummary">This article provides a detailed rundown of how to run the actual gaia-ui-tests suite that resides inside Gaia itself, on B2G Desktop, and real Firefox OS devices. The Gaia project uses <a href="https://treeherder.mozilla.org/">Treeherder</a> to do per-commit continuous integration and pull request tests.</span></p>
</div>

<p>The gaia-ui-tests have been developed with the capability to run on a real device device, emulators, and the <a href="/en-US/Firefox_OS/Using_the_B2G_desktop_client">B2G Desktop</a> client. By far the easiest method is to run against B2G Desktop. Please note that you should <u><strong>choose the right branch</strong></u> of Gaia to run against the version of Firefox OS that you are using.</p>

<h2 id="Testing_on_B2G_Desktop">Testing on B2G Desktop</h2>

<p>The B2G desktop client is as it sounds: it's a desktop version of B2G that you can use to perform web app tests on Firefox OS from the comfort of your desktop. If you are not familiar with it, you can find more out by reading <a href="/en-US/Firefox_OS/Using_the_B2G_desktop_client">Using the B2G desktop client</a>. This section will show you how to run gaia-ui-tests on B2G desktop.</p>

<div class="note">
<p><strong>Shortcut</strong>: If you don't want to setup the environment manually, you can use <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox_OS/Automated_testing/MozITP">MozITP</a> — this toolset will automatically set up a pre-configured Ubuntu VM and Gaia UI Test environment allowing you to start running tests on Mulet or a real device in one click.</p>
</div>

<div>
<h3 id="Prerequisites">Prerequisites</h3>

<ul>
 <li>A B2G desktop build. You can either <a href="http://nightly.mozilla.org/">download</a> it (including from a Try push) and unpack to a directory on your computer or virtual machine or <a href="/en-US/Firefox_OS/Using_the_B2G_desktop_client#Building_the_desktop_client">compile it yourself</a>, with the addition of <code>ENABLE_MARIONETTE=1</code> in your mozconfig.</li>
 <li>The <a href="https://github.com/mozilla-b2g/gaia/">Gaia Github repository</a> cloned and checked out. You will also need to generate a profile. Note that you <em>must not</em> pass <code>DEBUG=1</code> while generating the profile - using a debug gaia profile will cause gaia-ui-tests to fail to connect with the b2g desktop instance.</li>
 <li>A <code>testvars.json</code> file; see <a href="#Configuring_test_variables">Configuring test variables</a>.</li>
</ul>
</div>

<p>The desktop B2G client is ideal for developing tests when a real device is unavailable and there is no need for phone-level functions. It is fast, accessible, and will run on Linux, Mac, and Windows!</p>

<h3 id="Running_the_tests">Running the tests</h3>

<p>We'll look at running new tests; we'll install the in-tree version of gaiatest directly from the Gaia repository so that our changes are picked up immediately. In your cloned version of Gaia, navigate to <code>gaia/tests/python/gaia-ui-tests</code> and run the setup command:</p>

<pre class="brush: bash">python setup.py develop</pre>

<p>This might give permission denied errors when not running it inside a virtual environment. In that case, install <code>virtualenv</code> and <code>virtualenvwrapper</code>, if you haven't already done so:</p>

<pre>pip install virtualenv
pip install virtualenvwrapper (perhaps need to use sudo here)
export WORKON_HOME=~/Envs
source /usr/local/bin/virtualenvwrapper.sh
<code class="java plain">echo </code><code class="java string">"source /usr/local/bin/virtualenvwrapper.sh"</code> <code class="java plain">&gt;&gt; .bash (rc or _profile)</code></pre>

<p>Then, create and enter the virtual environment:</p>

<pre>mkvirtualenv gaia-ui-test</pre>

<p>Via Marionette, <code>gaiatest</code> is able to launch the B2G Desktop when we start the test. To do this, you need to pass in the path to the B2G binary file and B2G profile. In the below example we have included the <code>$HOME</code> variable as the path to the <code>b2g</code> binary and the b2g profile. This will simply be the location that you unzipped B2G Desktop to after you downloaded it. The command to run all the tests is:</p>

<pre class="brush: bash">gaiatest --binary=$HOME/b2g/b2g-bin --profile=$HOME/b2g/gaia/profile --testvars=testvars.json --restart --type=b2g ./gaiatest/tests/functional/manifest.ini
</pre>

<p>Tests that are incompatible with the B2G Desktop client — for example those that make calls and send SMS — are automatically skipped from the test run.</p>

<p>You can run a test directly by calling the file on the command line:</p>

<pre class="brush: bash">gaiatest --binary=$HOME/b2g/b2g-bin --profile=$HOME/b2g/gaia/profile --testvars=testvars.json --restart ./gaiatest/tests/functional/clock/test_clock_set_alarm.py
</pre>

<h2 id="Testing_on_Firefox_OS_devices">Testing on Firefox OS devices</h2>

<p>Testing on real Firefox OS devices is more complicated, but for obvious reasons gives the most accurate results. With access to all available device APIs, hardware features, and so forth. However, you can test on the emulator if you don't have a real Firefox OS device, or if the features you're using don't require real hardware. You can also test general functionality in the emulator.</p>

<div class="note">
<p>If you don't want to setup the environment manually. You can try <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox_OS/Automated_testing/MozITP">MozITP</a>, it will automatically setup a pre-configured Ubuntu VM and Gaia UI Test environment, so you can start testing on real device or simulator in one-click.</p>
</div>

<h3 id="Prerequisites_2">Prerequisites</h3>

<ul>
 <li><a href="/en-US/Firefox_OS/Debugging/Installing_ADB">Android Debug Bridge installed</a> and <a href="/en-US/Firefox_OS/Firefox_OS_build_prerequisites#For_Linux.3A_configure_the_udev_rule_for_your_phone">udev rules configured.</a></li>
 <li>A Firefox OS device with a Marionette-enabled build.</li>
 <li>The <a href="https://github.com/mozilla-b2g/gaia/">Gaia Github repository</a> branch that matches your Firefox OS device cloned and checked out.</li>
 <li>A <code>testvars.json</code> file; see <a href="#Configuring_test_variables">Configuring test variables</a>.</li>
</ul>

<h3 id="Running_the_tests_2">Running the tests</h3>

<p>The gaiatest package is needed to run the tests. We need to install this for the branch that we want to run the tests on. Navigate to the <code>gaia/tests/python/gaia-ui-tests/</code> directory and install gaiatest with this command:</p>

<pre class="brush: bash">python setup.py develop</pre>

<div class="note">
<p><strong>Note</strong>: Before you start to run the test, read through <a href="http://gaiatest.readthedocs.org/en/latest/testrunner.html#risks" title="https://developer.mozilla.org/en-US/docs/Gaia_Test_Runner#Risks">this warning</a> in order to acknowledge that running gaia-ui-tests on a device may cause data to be deleted from the device!</p>
</div>

<div class="note">
<p><strong>Debug Firefox OS builds: </strong>Firefox OS builds built with DEBUG=1 will need a greater timeout than the default (20 seconds). Try adding to the command line --timeout 60000 or higher, depending upon the speed of the device.</p>
</div>

<p>Marionette on the device awaits commands on port 2828. We need to forward our local port to the remote port on the device using adb. Run the following command:</p>

<pre class="brush: bash">adb forward tcp:2828 tcp:2828</pre>

<p>Please be reminded that you'll need to start your emulator before the command, if you are not running on a real Firefox OS device.</p>

<p>You can use the following command to execute all the gaia-ui-tests:</p>

<pre class="brush: bash">gaiatest --address=localhost:2828 --testvars=&lt;TESTVARS_FILE&gt; --restart --type=b2g gaiatest/tests/functional/manifest.ini
</pre>

<p>Or use the following if you want to run a single test (substituting the last part for the actual test you want to run):</p>

<pre class="brush: bash">gaiatest --address=localhost:2828 --testvars=&lt;TESTVARS_FILE&gt; --restart gaiatest/tests/functional/clock/test_clock_create_new_alarm.py
</pre>

<p>After the test, you will see all the pass/fail results and stacktraces for each file.</p>

<h2 id="Testing_locally_with_Treeherder_configuration_for_Gecko_and_Gaia_developers"><a name="RunningTBPL"></a>Testing locally with Treeherder configuration for Gecko and Gaia developers</h2>

<p>In this section we will focus upon replicating a Treeherder test locally. Before testing locally with a Treeherder configuration, you need to be aware that it builds a Gaia profile separately. The profile that comes packaged with the Treeherder build or rel-eng build is NOT the same Gaia profile that Treeherder uses.</p>

<div>
<h3 id="Prerequisites_3">Prerequisites</h3>

<ul>
 <li>A B2G desktop build. You can either <a href="http://nightly.mozilla.org/">download</a> it (including from a Try push) and unpack to a directory on your computer or virtual machine or <a href="/en-US/Firefox_OS/Using_the_B2G_desktop_client#Building_the_desktop_client">compile it yourself</a>, with the addition of <code>ENABLE_MARIONETTE=1</code> in your mozconfig.</li>
 <li>The <a href="https://github.com/mozilla-b2g/gaia/">Gaia Github repository</a> checked out (for making the Gaia profile, and installing gaiatest and the test files).</li>
 <li>A <code>testvars.json</code> file; see <a href="#Configuring_test_variables">Configuring test variables</a>.</li>
</ul>
</div>

<h3 id="Building_a_Gaia_profile_with_Treeherder's_settings">Building a Gaia profile with Treeherder's  settings</h3>

<p>Before building a profile we need to check the environment variables that were used to build the profile. Searching in the "brief log" of the Gu test run, find this command block:</p>

<pre class="brush: bash">Using env: {'DEBUG': '0',
            'DESKTOP': '0',
            'DESKTOP_SHIMS': '0',
            'NOFTU': '0'}
</pre>

<p>These settings can drastically change the way desktop B2G behaves. It is very important to match Treeherder's settings.</p>

<p>The next step is to checkout the git commit that matches the hg commit that Treeherder ran with. You can also find the hg commit in the "brief log" of the Treeherder run but you will need to correlate that with the git commit yourself.</p>

<p>The gaia test repository includes a <code>make</code> script for building a Gaia profile. Navigate to the Gaia repo that you have cloned locally, and build the profile using the environment variables we found on Treeherder:</p>

<pre class="brush: bash">DEBUG=0 DESKTOP=0 DESKTOP_SHIMS=0 NOFTU=0 make</pre>

<h3 id="Running_the_tests_3">Running the tests</h3>

<p>Using the same git commit that Treeherder used to run the test, go to the <code>gaia/tests/python/gaia-ui-tests</code> directory and install gaiatest using the following command:</p>

<pre class="brush: bash">python setup.py develop</pre>

<p>Now that you have built the Gaia profile, the only significant difference to running these tests is that you must direct gaiatest to the binary location and profile location.</p>

<p>Inside the <code>gaia-ui-tests</code> directory, run the below command, with the following substitutions made:</p>

<ul>
 <li><code>$BINARY_PATH</code>: The path to the <code>b2g-bin</code> file in the directory you have built or unpacked desktop B2G to.</li>
 <li><code>$PROFILE_PATH</code>: The path to your locally build Gaia profile. If built from the Gaia repository it will be <code>~/gaia/profile</code>.</li>
</ul>

<pre class="brush: bash">gaiatest --binary $BINARY_PATH/b2g/b2g-bin --profile $PROFILE_PATH/profile --restart --testvars testvars.json gaiatest/tests/manifest.ini --type=b2g</pre>

<div class="note">
<p><strong>Note</strong>: There is no need to forward port 2828 unless you have set the Marionette server to use a different default port.</p>
</div>

<div class="warning">
<p><strong>Important</strong>: Try to keep your mouse cursor clear of the b2g window so that pointer events do not pollute the test run.</p>
</div>

<h3 id="Finding_the_HTML_report_for_a_completed_Treeherder_job">Finding the HTML report for a completed Treeherder job</h3>

<p>All Treeherder jobs (both pass and fail) have an HTML report output generated and stored.</p>

<ol>
 <li>For the commit and <em>Gip</em> job, click the chunk of interest (e.g., f1, f2).</li>
 <li>In the status bar at the bottom of the screen find the section titled: <strong><label>artifact uploaded</label></strong> <span> <span class="ng-binding ng-scope">output.html</span></span>.</li>
 <li>Click link to view the report.</li>
</ol>

<h2 id="Testing_against_an_already_running_Desktop_B2G_binary">Testing against an already running Desktop B2G binary</h2>

<p>In this section we will look at running the tests against an already running Desktop B2G binary with modified source code.</p>

<div>
<h3 id="Prerequisites_4">Prerequisites</h3>

<ul>
 <li>A B2G desktop build with your Gecko changes. You can either <a href="http://nightly.mozilla.org/">download</a> it (including from a Try push) and unpack to a directory on your computer or virtual machine or <a href="/en-US/Firefox_OS/Using_the_B2G_desktop_client#Building_the_desktop_client">compile it yourself</a>, with the addition of <code>ENABLE_MARIONETTE=1</code> in your mozconfig.</li>
 <li>Your debugger of choice attached to the B2G binary.</li>
 <li>The <a href="https://github.com/mozilla-b2g/gaia/">Gaia Github repository</a> checked out (for installing gaiatest and the test files).</li>
 <li>A <code>testvars.json</code> file; see <a href="#Configuring_test_variables">Configuring test variables</a>.</li>
</ul>
</div>

<h3 id="Running_the_tests_4">Running the tests</h3>

<p>Running tests against an existing b2g process is quite easy — you've already gone through the hard parts to build B2G!</p>

<p>If you have not already installed gaiatest then do so now by going to <code>gaia/tests/python/gaia-ui-tests</code> and running the following:</p>

<pre class="brush: bash">python setup.py develop</pre>

<p>Once you have started the b2g binary process and attached your debugger you need to direct gaiatest to the port using the <code>--address</code> command. Do not use <code>--binary</code> or <code>--profile</code>, otherwise gaiatest will just send commands directly to the port without attempting to start or close the binary.</p>

<pre class="brush: bash">gaiatest --testvars testvars.json gaiatest/tests/functional/test_that_is_being_debugged.py</pre>

<div class="note">
<p><strong>Note</strong>: We have omitted the <code>--restart</code> command too. As gaiatest does not attempt to stop or start the binary, some data from your test run may be left behind in Firefox OS databases or even in the DOM. It is your responsibility to reset B2G back to a basic state before trying to run the test for a second time.</p>
</div>

<h2 id="Configuring_test_variables">Configuring test variables</h2>

<p>You can customize variables used during the test using a <code>testvars.json</code> file. The gaia-ui-tests will wipe the databases on your phone in order to give the test a clean profile to run against. Gaiatest contains protection against running and wiping your device's data. Please read <a href="https://developer.mozilla.org/en-US/docs/Gaia_Test_Runner#Risks" title="https://developer.mozilla.org/en-US/docs/Gaia_Test_Runner#Risks">the warning</a> before you set up your test variables file.</p>

<p>We use the <code>--testvars</code> option to pass in local variables, particularly those that cannot be checked into the repository. For example in gaia-ui-tests these variables can be your private login credentials, phone number, or details of your WiFi connection.</p>

<p>To use it, copy <code>testvars_template.json</code> to a different filename but add it into <code>.gitignore</code> so you don't check it into your repository.</p>

<p>When running your tests add the argument: <code>--testvars=(filename).json</code></p>

<h3 id="How_to_configure_WiFi_using_testvars.json_(for_devices)"><strong>How to configure WiFi using </strong>testvars.json (for devices)</h3>

<p>By setting the WiFi key in <code>testvars.json</code> you can configure the Firefox OS Settings database with your WiFi configuration. Then the test cases can use your WiFi connection.</p>

<p>No WiFi authentication:</p>

<pre><code class="brush: bash">"wifi": { "ssid": "MyNetwork"} </code></pre>

<p>WEP authentication:</p>

<pre><code>"wifi": { "ssid": "MyNetwork", "keyManagement": "WEP", "wep": "MyPassword" } </code></pre>

<p>WPA-PSK authentication:</p>

<pre><code>"wifi": { "ssid": "MyNetwork", "keyManagement": "WPA-PSK", "psk": "MyPassword" } </code></pre>

<div class="note">
<p><strong>Note:</strong> Due to <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=775499" title="FIXED: [Wifi] Support subject_match to WPA-EAP Enterprise networks">bug 775499</a>, WiFi connections via WPA-EAP are not possible at this time.</p>
</div>

<h2 id="Troubleshooting">Troubleshooting</h2>

<p>This section details some common error messages, offering potential solutions for each.</p>

<h3 id="Common_problems_before_the_test_has_started">Common problems before the test has started</h3>

<table class="standard-table">
 <thead>
  <tr>
   <th scope="col" style="text-align: center;"><strong>Error Message </strong></th>
   <th scope="col" style="text-align: center;"><strong>Corresponding Actions</strong></th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td>error: [Errno 111] Connection refused</td>
   <td>
    <p>Reissue the "adb forward tcp:2828 tcp:2828" command<br>
     <br>
     B2G process is not running</p>
   </td>
  </tr>
  <tr>
   <td>Element ... not visible before timeout</td>
   <td>Make sure the element would display on the app you test</td>
  </tr>
  <tr>
   <td>TimeoutException: Condition timed out</td>
   <td>make sure the condition on the app is the same as your expectations</td>
  </tr>
  <tr>
   <td>marionette.errors.MarionetteException: localhost:2828 is unavailable.</td>
   <td>Something is blocking the port, often the `adb forward` command. `adb kill-server` will resolve that, or closing the app that is keeping the port open</td>
  </tr>
  <tr>
   <td>ImportError: No module named bluetooth</td>
   <td>
    <p>Replace <code>--type=b2g</code> in your command with <code>--type=b2g-bluetooth</code><br>
     OR<br>
     Install pybluez Python bluetooth package</p>
   </td>
  </tr>
  <tr>
   <td>OSError: [Errno 2] No such file or directory: '~/moz/gaia/profile'</td>
   <td>Check to make sure that you have not used ~ on the command line where you meant $HOME.</td>
  </tr>
 </tbody>
</table>