---
title: 'Part 2: Basic interactions with Firefox OS using Marionette'
slug: >-
  Archive/B2G_OS/Automated_testing/gaia-ui-tests/Part_2_Marionette_Firefox_OS_interactions
tags:
  - Automation
  - Firefox OS
  - Gaia
  - Python
  - gaia-ui-tests
  - tests
---
<p></p><section class="Quick_links" id="Quick_Links">

<ol>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_build_process_summary">B2G OS build process summary</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/B2G_OS_build_prerequisites">Build prerequisites</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Preparing_for_your_first_B2G_build">Preparing for your first build</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building">Building B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_installer_add-on">B2G installer add-on</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Building_for_Flame_on_OS_X">Building B2G OS for Flame on Mac OS X</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Choosing_how_to_run_Gaia_or_B2G">Choosing how to run Gaia or B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Compatible_Devices">Compatible Devices</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Installing_on_a_mobile_device">Installing B2G OS on a mobile device</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_update_packages">Creating and applying B2G OS update packages</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building/FOTA_community_builds">Building and installing FOTA community builds</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_Build_Variables_Reference_Sheet">B2G build variables reference sheet</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting B2G OS</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/basics">Porting basics</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/Porting_on_CyanogenMod">Porting on CyanogenMod</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Running_the_Gaia_codebase">Running the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Mulet">Run Gaia on desktop using Mulet</a></li>

   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Understanding_the_Gaia_codebase">Understanding the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Making_Gaia_code_changes">Making Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Testing_Gaia_code_changes">Testing Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Submitting_a_Gaia_patch">Submitting a Gaia patch</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Build_System_Primer">Gaia build system primer</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Different_ways_to_run_Gaia">Different ways to run Gaia</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/make_options_reference">Make options reference</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Gaia_tools_reference">Gaia tools reference</a></li>
  </ol>
 </li>
 <li><a href="/en-US/docs/Mozilla/B2G_OS/API">B2G OS APIs</a></li>
</ol>
</section><p></p><p></p><div style="text-align: right;" class="prevnext">
    <p><a style="float: left;" href="/en-US/docs/Mozilla/Firefox_OS/Platform/Automated_testing/gaia-ui-tests/Part_1_Marionette_Firefox_OS_start" class="button">« Previous</a><a href="/en-US/docs/Mozilla/Firefox_OS/Platform/Automated_testing/gaia-ui-tests/Part_3_Reusable_tests" class="button">Next  »</a></p>
</div><p></p>

<div class="summary">
<p><span class="seoSummary">In part 2 of our tutorial we’ll get started with some simple Marionette commands that allow us to remotely control Firefox OS. While this doesn&apos;t cover writing a full test, it teaches you the basic code features that you will use while writing a test. In part 3, we’ll progress onto evolving this code into a real test.</span></p>
</div>

<h2 id="Starting_up_Firefox_OS">Starting up Firefox OS</h2>

<p>When writing these tests we’ll need to have Firefox OS already running and ready to receive commands:</p>

<ol>
 <li>Start up desktop B2G.</li>
 <li>Disable the lock screen using <em>Settings App &gt; Screen lock &gt; uncheck Lock screen</em>.</li>
 <li>Disable screen timeout/sleep mode by changing the <em>Settings App &gt; Display &gt; Screen timeout</em> setting to <em>never</em>.</li>
 <li>Move the window over to the side to await our test commands.</li>
</ol>

<h2 id="Firing_up_Marionette">Firing up Marionette</h2>

<p>Now we will start a Python console: simply go to a Terminal window and issue the <code>python</code> command.</p>

<p>From here we can send commands to the Marionette server inside Firefox OS. After issuing many of the below commands you should see Firefox OS respond. In the Python console, enter the following command to import the Marionette library containing the code we need:</p>

<pre class="brush: bash">from marionette import Marionette</pre>

<p>Now run the next two lines, which initiate a Marionette session, preparing Marionette to receive commands from the client:</p>

<pre class="brush: bash">marionette = Marionette()
marionette.start_session()</pre>

<p>If you didn&apos;t disable the lock screen as explained above, you can unlock the screen programmatically, using this command:</p>

<pre class="brush: bash">marionette.execute_script(&apos;window.wrappedJSObject.lockScreen.unlock();&apos;)</pre>

<h2 id="Accessing_different_frames_inside_Firefox_OS">Accessing different frames inside Firefox OS</h2>

<p>Web apps in Firefox OS operate in different iFrames. Running web apps in separate frames gives them distinct containers for security and also visual management (like a window). You can think of it like a sandbox the app runs in. Marionette can only operate in one of the frames at a time. We need Marionette to switch into the frame that we’re intending to interact with.</p>

<p>The top frame is also the System app. All apps and their frames are children of the System app. Our new Marionette session starts in the System frame but to start the test we&apos;ll need to find and switch into the home screen.</p>

<p>To find the iFrame, we need to identify it somehow. As Marionette is based on the WebDriver API, it uses the same strategies to locate elements, so we can easily use any of the strategies used to identify WebDriver web elements. Read more information on <a href="http://www.w3.org/TR/webdriver/#element-location-strategies">element location strategies</a>.</p>

<p>In this case we will use the CSS Selector <code>div.homescreen iframe</code> to select the homescreen iFrame; the <code>find_element()</code> function takes this as its second argument, the first argument being a definition of what selection mechanism is being used to perform the find. We&apos;ll then store this result in a variable and run the <code>switch_to_frame()</code> function with that as the argument. Try the following two commands now:</p>

<pre class="brush: bash"># Switch context to the homescreen iframe and tap on the Contacts app icon
home_frame = marionette.find_element(&apos;css selector&apos;, &apos;div.homescreen iframe&apos;)
marionette.switch_to_frame(home_frame)</pre>

<div class="note">
<p><strong>Note</strong>: For further reading and diagrams describing switching frames, please read <a href="https://blog.mozilla.org/webqa/2013/02/13/part-2-ui-testing-on-firefox-os-working-with-iframes/">Working with iFrames</a>.</p>
</div>

<h2 id="Opening_an_application">Opening an application</h2>

<p>OK. Now we’re in the Homescreen app we can target icons and tap on them using the <code>find_element()</code> function, in combination with the <code>tap()</code> function.</p>

<pre class="brush: bash"><code>contacts_icon = marionette.find_element(&apos;xpath&apos;, &quot;</code><code>//div[@class=&apos;icon&apos;]//span[contains(text(),&apos;Contacts&apos;)]&quot;)</code>
contacts_icon.tap()</pre>

<p>If that’s all gone right then you should now have seen the Contacts app open, but we still need to switch into the Contacts app frame in order to interact with it, like we did with the Homescreen earlier:</p>

<pre class="brush: bash"># First, we need to switch context back to the System frame
marionette.switch_to_frame()

# Now, switch context to the contacts app frame
contacts_frame = marionette.find_element(&apos;css selector&apos;, &quot;iframe[data-url*=&apos;contacts&apos;]&quot;)
marionette.switch_to_frame(contacts_frame)</pre>

<p>Switch to frame should return <code>True</code>. If it did, then great  this means we are inside the contacts app context and ready to start using it.</p>

<h2 id="Manipulating_the_app">Manipulating the app</h2>

<p>In the next step we’ll perform a typical test task — creating a new contact, entering a name into it, and saving it. First, we&apos;ll tap the add contact button:</p>

<pre class="brush: bash"># Tap [+] to add a new Contact
marionette.find_element(&apos;id&apos;, &apos;add-contact-button&apos;).tap()</pre>

<p>Now let’s add the contact&apos;s name using the next two commands (<code>send_keys()</code> is used to insert a value into an element):</p>

<pre class="brush: bash">marionette.find_element(&apos;id&apos;, &apos;givenName&apos;).send_keys(&apos;Foo&apos;)
# Add the contact&apos;s surname
marionette.find_element(&apos;id&apos;, &apos;familyName&apos;).send_keys(&apos;Bar&apos;)</pre>

<p>Now let’s tap the <em>Done</em> button to save the Contact:</p>

<pre class="brush: bash"><code class="language-html">marionette.find_element(&apos;id&apos;, &apos;save-button&apos;).tap()</code></pre>

<p>Now you should see a new contact entered inside the Contacts app. If so, great!</p>

<div class="note">
<p><strong>Note</strong>: If you don&apos;t, reset or kill the Contacts app and navigate Firefox OS back to the Homescreen and try running the task again.</p>
</div>

<h2 id="Closing_your_Marionette_session">Closing your Marionette session</h2>

<p>Finally, you should finish your Marionette session by issuing the following command:</p>

<pre class="brush: bash">marionette.delete_session()</pre>

<p>That worked pretty well, but you can’t go typing into a Python console each time you want to run a test. In Part 3, we’ll compile this script into a Python file which we can reuse each time we want to run the test. We’ll also add an assertion so that we can distinguish whether the test has passed or failed.</p>

<div class="note">
<p><strong>Note</strong>: When writing Marionette commands, you&apos;ll certainly notice that accessing the underlying HTML structure of the app is vitally important to figure out the locators you need. <a href="https://developer.mozilla.org/en-US/Firefox_OS/Platform/Automated_testing/gaia-ui-tests/Part_7_Writing_your_own_tests#Resources">Part 7: Writing your own tests</a> offers some useful resources to help you with this.</p>
</div>

<p> </p>
