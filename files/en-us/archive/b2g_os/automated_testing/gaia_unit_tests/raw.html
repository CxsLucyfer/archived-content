<p></p><section class="Quick_links" id="Quick_Links">

<ol>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS">Build and install overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_build_process_summary">B2G OS build process summary</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/B2G_OS_build_prerequisites">Build prerequisites</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Preparing_for_your_first_B2G_build">Preparing for your first build</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building">Building B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_installer_add-on">B2G installer add-on</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Building_for_Flame_on_OS_X">Building B2G OS for Flame on Mac OS X</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Choosing_how_to_run_Gaia_or_B2G">Choosing how to run Gaia or B2G OS</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/Compatible_Devices">Compatible Devices</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Installing_on_a_mobile_device">Installing B2G OS on a mobile device</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_OS_update_packages">Creating and applying B2G OS update packages</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building/FOTA_community_builds">Building and installing FOTA community builds</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Building_and_installing_B2G_OS/B2G_Build_Variables_Reference_Sheet">B2G build variables reference sheet</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting B2G OS</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS">Porting overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/basics">Porting basics</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Porting_B2G_OS/Porting_on_CyanogenMod">Porting on CyanogenMod</a></li>
  </ol>
 </li>
 <li data-default-state="closed"><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia</a>
  <ol>
   <li><strong><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia">Developing Gaia overview</a></strong></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Running_the_Gaia_codebase">Running the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Mulet">Run Gaia on desktop using Mulet</a></li>

   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Understanding_the_Gaia_codebase">Understanding the Gaia codebase</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Making_Gaia_code_changes">Making Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Testing_Gaia_code_changes">Testing Gaia code changes</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Submitting_a_Gaia_patch">Submitting a Gaia patch</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Build_System_Primer">Gaia build system primer</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Different_ways_to_run_Gaia">Different ways to run Gaia</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/make_options_reference">Make options reference</a></li>
   <li><a href="/en-US/docs/Mozilla/B2G_OS/Developing_Gaia/Gaia_tools_reference">Gaia tools reference</a></li>
  </ol>
 </li>
 <li><a href="/en-US/docs/Mozilla/B2G_OS/API">B2G OS APIs</a></li>
</ol>
</section><p></p><div class="summary">
<p>As part of the Gaia/B2G source code, we have made various unit tests available to run, for testing different aspects of Gaia and B2G. This article explains how to access these.</p>
</div>

<div class="note">
<p><strong>Note</strong>: This document assumes you fully understand how to work within Gaia and B2G. See <a href="/en-US/Firefox_OS/Developing_Gaia">Developing Gaia</a> to get started with Gaia.</p>
</div>

<h2 id="Running_unit_tests">Running unit tests</h2>

<p>You can run the unit tests on <a href="/en-US/Firefox_OS/Using_the_B2G_desktop_client">B2G desktop</a>, <a href="http://nightly.mozilla.org/">Firefox Nightly</a> or <a href="/en-US/Firefox_OS/Developing_Gaia/Different_ways_to_run_Gaia#Using_Gaia_in_Firefox_Mulet">Mulet</a>. You also need the latest <a href="https://github.com/mozilla-b2g/gaia/">Gaia repo</a>. For most of the functionality, you must also have <a class="external" href="http://nodejs.org/" title="http://nodejs.org/">Node.js</a> and <a class="external" href="http://npmjs.org/" title="http://npmjs.org/">NPM</a> installed.</p>

<div class="warning">
<p><strong>Warning</strong>: We'll likely deprecate running tests in Firefox soon. Please use <a href="/en-US/Firefox_OS/Developing_Gaia/Different_ways_to_run_Gaia#Using_Gaia_in_Firefox_Mulet">Mulet</a> from now on.</p>
</div>

<div class="note">
<p><strong>Note</strong>: If the following commands fail with cryptic errors while installing test-agent dependencies, it might be due to your Node.js/NPM versions being too old. Read <a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">Installing Node.js via package manager</a> in order to install the latest versions and delete the <code>node_modules/test-agent</code> folder. You can also use tools like <a href="https://github.com/creationix/nvm/">nvm</a>, or even install the zip file and manage the symbolic links manually.)</p>
</div>

<div class="note">
<p><strong>Note</strong>: On Ubuntu, Debian, and possibly some other Linux distros too, the <code>nodejs</code> package installs as a <code>nodejs</code> executable instead of <code>node</code> as usual. The <code>node</code> <code>p</code>ackage is the Amateur Packet Radio "Node" program. If you are getting a problem with running unit tests on these systems (error messages might say that <em>"This failure might be due to the use of legacy binary 'node' "</em>), then you should install the node package <strong>nodejs-legacy</strong>. This conflicts with <em>the Amateur Packet Radio "Node" Program,</em> removing its <code>/usr/sbin/node</code> and making it into a symlink to <code>/usr/bin/nodejs</code> instead, which should make things work as expected.</p>
</div>

<p>The Gaia repo contains a rather handy <code>bin/gaia-test</code> script, which helps running the tests in an easier way.</p>

<div class="note">
<p><strong>Note: </strong>This script will generate a profile suited for unit tests in either <code>profile-gaia-test-firefox/</code> or <code>profile-gaia-test-b2g/</code> depending on the mode you choose, if the directory does not exist yet. You can override this default choice using the environment variable <code>PROFILE_FOLDER</code>. If the profile already exists, it will just use it instead of overwriting it. You can force a profile generation using the <code>-f</code> parameter to the script, which is necessary in some cases.</p>
</div>

<h3 id="Launching_the_test_runner_in_Mulet_or_Firefox">Launching the test runner in Mulet or Firefox</h3>

<p>This will run the test server and launch your default Firefox as found in the path:</p>

<pre class="brush: bash">bin/gaia-test</pre>

<h4 id="Choosing_Firefox_binary">Choosing Firefox binary</h4>

<p>You can export the FIREFOX environment variable to your firefox binary. For example, on OS X:</p>

<pre class="brush: bash">export FIREFOX=/Applications/FirefoxNightly.app/Contents/MacOS/firefox</pre>

<p>Alternatively, you can pass it as argument to bin/gaia-test:</p>

<pre class="brush: bash">bin/gaia-test &lt;gaia directory&gt; &lt;firefox path&gt;</pre>

<h3 id="Launching_the_test_runner_in_B2G_Desktop">Launching the test runner in B2G Desktop</h3>

<p>This will download and launch B2G Desktop:</p>

<pre class="brush: bash">bin/gaia-test -d</pre>

<h4 id="Choosing_B2G_Desktop_binary">Choosing B2G Desktop binary</h4>

<p>You can use the environment variable B2G to point to your B2G Desktop binary:</p>

<pre class="brush: bash">export B2G=/home/user/gecko/obj-x86_64-unknown-linux-gnu/dist/bin/b2g</pre>

<p>Alternatively, you can pass it as argument to bin/gaia-test:</p>

<pre class="brush: bash">bin/gaia-test &lt;gaia directory&gt; &lt;B2G path&gt;</pre>

<h3 id="Launching_the_test_runner_with_gdb">Launching the test runner with gdb</h3>

<p>Use the <code>-g</code> option:</p>

<pre class="brush: bash">bin/gaia-test -g</pre>

<p>This works with both B2G Desktop and Firefox/Mulet. Of course it's a good idea to point to a binary built in debug mode (see above).</p>

<p>You can also use the environment variable GDB_ARGS to give more arguments to gdb:</p>

<pre class="brush: bash">GDB_ARGS="--symbols=&lt;SYMFILE&gt;" FIREFOX="&lt;path to Firefox&gt;" bin/gaia-test -g</pre>

<p>After the usual prerequisite steps you'll end up in the gdb command line interface:</p>

<pre>Reading symbols from /home/julien/firefox-nightly/firefox...(no debugging symbols found)...done.
(gdb)</pre>

<p>Because several commands are launched in background you may have some other lines interleaved. You can just type ENTER to see the gdb command line on its own line.</p>

<p>Firefox uses the signal SIG38 and gdb stops at this signal, so you'll need to ask gdb to not stop before running the binary. You can enter this command to do just this:</p>

<pre>(gdb) handle SIG38 nostop</pre>

<p>Then add the breakpoints you want, and you can run the binary:</p>

<pre>(gdb) r</pre>

<h3 id="Run_the_tests_from_the_Web_Interface">Run the tests from the Web Interface</h3>

<p>You can simply click on specific tests and then the <em>Execute</em> button.</p>

<h3 id="Run_the_tests_from_the_command_line">Run the tests from the command line</h3>

<p>With the WebSocket server running, and the Test Agent app running in B2G Desktop/Firefox Nightly, run the following command:</p>

<pre>make test-agent-test
</pre>

<p>If you only want to run one app's tests you can specify which via the <code>APP</code> env variable:</p>

<pre class="brush: bash">make test-agent-test APP=calendar
# or
APP=calendar make test-agent-test</pre>

<p>You can also optionally provide a <a class="external" href="http://visionmedia.github.com/mocha/#reporters" title="http://visionmedia.github.com/mocha/#reporters">reporter</a> to format the test output:</p>

<pre>REPORTER=List make test-agent-test
</pre>

<div class="note"><strong>Note:</strong> Not all reporters work, since we currently do not support Doc.</div>

<h3 id="Run_the_tests_as_you_save">Run the tests as you save</h3>

<p>When the server is running, the tests for a file are run automatically when a file is saved or even just touched:</p>

<ul>
 <li>When you save a test file, the test file itself is run</li>
 <li>When you save another file, it finds a matching file in the <code>test/unit</code> directory, by suffixing the file name with <code>_test.js</code>.</li>
</ul>

<div class="note">
<p><strong>Note: </strong>It watches only existing files so if you create a new file, you have to restart the agent.</p>
</div>

<h3 id="Running_tests_like_Buildbot_does">Running tests like Buildbot does</h3>

<p>Gaia unit tests in Buildbot are run using a separate runner; this explains how to use it.  Please consult the <a href="/en-US/docs/Python/Virtualenv" title="/en-US/docs/Python/Virtualenv">virtualenv</a> docs if you're not familiar with using a Python virtualenv.</p>

<pre class="brush: bash">virtualenv venv
source venv/bin/activate
cd $GAIA/tests/python/gaia-unit-tests
python setup.py develop
cd gaia_unit_test
python main.py --binary /path/to/b2g/desktop/build --profile /path/to/gaia/profile
</pre>

<div class="note">
<p><strong>Note</strong>: When specifying the path to the B2G desktop build, you should specify the path to <code>b2g-bin</code>, if it exists, otherwise use <code>b2g</code>.</p>
</div>

<p>The Gaia profile must be made using the following:</p>

<pre class="brush: bash">NO_LOCK_SCREEN=1 DEBUG=1 DESKTOP=0 make</pre>

<p>By default, this profile will be generated in <code>$GAIA/profile-debug</code>. <code>bin/gaia-test</code> generates the same profile so you don't need to regenerate it if you already run <code>gaia-test</code>.</p>

<h3 id="Disabling_a_gaia_unit_test_in_automation">Disabling a gaia unit test in automation</h3>

<p>Automation uses a blacklist to exclude certain gaia unit tests from being run.  To prevent a test from running in automation, add its path to <a href="https://github.com/mozilla-b2g/gaia/blob/master/tests/python/gaia-unit-tests/gaia_unit_test/disabled.json">https://github.com/mozilla-b2g/gaia/blob/master/tests/python/gaia-unit-tests/gaia_unit_test/disabled.json</a>.</p>

<h2 id="Setting_up_your_Gaia_app">Setting up your Gaia app</h2>

<p>Although this guide should help make things easier, the best way to learn how to write, set up, and run tests is currently still to look at the source code; in particular, take a look at the <a class="link-https" href="https://github.com/lightsofapollo/gaia/tree/master/apps/gallery/test" title="https://github.com/lightsofapollo/gaia/tree/master/apps/gallery/test">gallery tests</a>.</p>

<h3 id="Loading_your_own_test_files" style="line-height: 24px; font-size: 1.71428571428571rem;">Loading your own test files</h3>

<div class="note">
<p><strong>Note</strong>: This is an advanced and entirely optional technique. If test-agent's native test loader is working for your application and your test style, and you don't want to use your own test files, this section is not for you!</p>
</div>

<p>Test-agent loads your test files in an environment where they have access to mocha (among other bits of global state). One important test-agent global is <code>require</code>, which allows your test file to load a dependency (application code for instance). Sometimes, particularly if your application files expect to be loaded in a way that's different from test-agent's <code>require</code>, it can be useful to override test-agent's test file loader. You can do so in the following manner:</p>

<pre class="brush: js" style="font-size: 14px;">// setup.js

testAgentRuntime.testLoader = function(path) {
  // We're going to return a promise to represent
  // the loading state of the test file at this path.
  return new Promise((accept, reject) =&gt; {
    // Load the parameter test file and resolve (or reject) appropriately
    // ...
  });
};</pre>

<h2 id="Using_mocks">Using mocks</h2>

<p>TBD</p>

<h2 id="Advanced_what_does_the_script_do">Advanced: what does the script do?</h2>

<h3 id="Generating_a_profile">Generating a profile</h3>

<p>You need a profile that is generated by this command:</p>

<pre class="brush: bash">NO_LOCK_SCREEN=1 DEBUG=1 DESKTOP=0 make
</pre>

<p>This generates a debug profile in <code>gaia/profile-debug</code>, overriding a previous profile if you already have one.</p>

<ul>
 <li><code>DEBUG=1</code> enables the <em>httpd.js</em> extension that makes it possible to directly use the files from the <code>apps/</code> directory.</li>
 <li><code>NO_LOCK_SCREEN=1</code> disables the lock screen, which is necessary in B2G Desktop because it's not possible to unlock it using the mouse.</li>
 <li><code>DESKTOP=0</code> disables the other addons we normally use in DEBUG mode to run Gaia in Firefox.</li>
</ul>

<h3 id="Launch_the_WebSocket_server">Launch the WebSocket server</h3>

<p>Test agent (the test runner) ships with a built in WebSocket server that lets you remotely message the browser or device to queue a test run. Often you will want to develop with time saving features like a file watcher that will run your tests when a test file or implementation changes. To take advantage of these features you need to start the server:</p>

<pre class="brush: bash">make test-agent-server
</pre>

<p>Using the WebSocket server provides other tools such as a command line reporter for test results (watch the terminal you ran the command from), a Growl reporter, syntax error notifications, and more.</p>

<p>The agent also watches for modifications in files, and automatically runs the associated tests. It runs when you save the test or if you save the tested file (we use the convention where the test filename is the tested filename with <code>_test</code> appended,<code> </code>see below for more examples). It watches only existing files so if you create a new file, you have to restart the agent.</p>

<h3 id="Running_unit_tests_with_Firefox_Nightly">Running unit tests with Firefox Nightly</h3>

<p>You can launch Gaia in Firefox Nightly with the following commands:</p>

<pre class="brush: bash">cd &lt;path to gaia&gt;
&lt;path to nightly&gt;/firefox --no-remote -profile &lt;path to gaia&gt;/profile-debug/ http://test-agent.gaiamobile.org:8080/</pre>

<div class="note">
<p><strong>Note</strong>: In OS X, The profile path should be absolute path</p>
</div>

<p>You can use Firebug or the integrated debugger to debug the tests; use the <code>debugger</code> keyword to break in the debugger.</p>

<h3 id="Running_unit_tests_with_B2G_Desktop">Running unit tests with B2G Desktop</h3>

<p>Launch Gaia and start the "Test Agent" app. From the Test gent app you can select tests to run from the UI.</p>

<h2 id="Advanced_how_does_the_test-agent_work">Advanced: how does the test-agent work?</h2>

<p>The Test Agent lives in<a href="https://github.com/mozilla-b2g/js-test-agent"> its own Github repository</a>. You can have look there to understand how it works under the hood.</p>

<h2 id="Toubleshooting">Toubleshooting</h2>

<h3 id="The_test_runner_stays_blank">The test runner stays blank</h3>

<p>Normally you'll see the list of existing tests displayed in the test runner (B2G Desktop, Firefox or Mulet). If this does not happen, this could be because something changed in Gecko. Usually we fix this by setting a pref, thus the easiest is to generate a new profile. You can do that by adding the option <code>-f</code> (for <em>force profile generation</em>) to <code>bin/gaia-test</code>:</p>

<pre class="brush: bash">bin/gaia-test -f
bin/gaia-test -d -f
</pre>

<h3 id="Error_listen_EADDRINUSE">Error: listen EADDRINUSE</h3>

<p>This happens when a test runner already runs. You should look at your other terminal windows !</p>

<h3 id="I_want_to_debug_the_included_httpd_extension">I want to debug the included httpd extension</h3>

<p>You can launch the script with <code>DEBUG=*</code>:</p>

<pre>DEBUG=* bin/gaia-test</pre>